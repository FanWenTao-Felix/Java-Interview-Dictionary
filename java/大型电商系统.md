# 大型电商系统

### 1.大型电商系统组成结构

16个中心+32个服务。

电商后台系统分成3大块：

1、管理后台：给公司内部各个部门使用的

包含的部门包括：运营、采购、招商、财务、客服，等等。

包含的子系统包括：系统管理、采购管理、销售管理、库存管理、会员管理、商品管理、订单管理、客服管理、商家管理、财务管理、数据统计、供应商管理，等等。

2、商家后台：给入驻电商网站的商家使用的

如果网站是自营商品，自行采购和售卖的话，是不存在入驻商家这一说法的，那么此时这块指的就不是商家，可能就是公司自己的商品售卖部门。

包含的子系统包括：店铺管理、商品管理、订单管理、营销管理、财务管理、客户管理、数据统计，等等。

3、WMS（仓储系统）

因为一般公司的仓储工作人员，跟其他部门的工作人员，办公地点不是在一个地方的。公司总部一般在办公楼里面，而仓储工作人员一般在仓库里面。所以这个WMS系统可以单独拉出来。

4、8大核心模块

商品、促销、购物车、订单、库存、物流、支付、会员。

1、管理后台

1.1 系统管理

这块主要是用来创建后台账号，分配权限，监控操作日志等操作的，一般只有整个电商后台系统的少数几个管理员，才有权限使用

1.2 采购管理

一般如果是自营的电商网站，都需要自己进行采购管理，核心是采购单，包含了采购计划、智能采购、供应商、仓库等信息，同时有采购入库和采购退货等核心流程，属于进销存中的“进”

1.3 销售管理

主要是针对网站中商品的销售设置的模块，包含了网站前台页面的CMS系统、专题页面、促销特卖活动、优惠券等等，都在这里，主要是针对如何让商品更好的售卖出去，属于进销存中的“销”

1.4 库存管理

主要是对商品的库存进行管理的，属于进销存中的“存”

1.5 会员管理

主要是进行会员体系的管理，同时针对用户进行数据收集、打标签、筛选，然后针对用户进行精准营销

1.6 商品管理

商品基本信息，包括了分类和品牌，等等；商品来源包括了网站自营和第三方商家

包含了商品的新建/编辑，第三方商品审查，商品上下架，商品查询，商品管理（组合、定价、库存，等等）

商品基础数据管理：类目、属性与品牌的管理

1.7 订单管理

主要是管理用户下的订单，包括订单流转，订单查询

1.8 客服管理

系统涵盖售前、售中、售后，售前是IM工具，售中是企业知识库，售后是工单系统

1.9 商家管理

商家入驻，商家信息管理，同时对商家店铺进行管理

1.10 财务管理

退款、与第三方商家结算、与供应商结算、往来现金和账款的管理

1.11 评价管理

管理所有商品的评价数据

1.12 数据统计

看到流量、转化、交易、商品、用户、商家等各个维度的数据

1.13 供应商管理

2、WMS（仓储系统）

2.1 系统设置

设置仓库的基础信息，包括了商品、库位和设备，仓库人员账号、操作权限以及操作日志

2.2 入库管理

包括采购入库、调拨入库、退货入库、生产入库，有入库流程和入库单

2.3 出库管理

包括销售出库、调拨出库、采购退货出库，出库流程包括了出库单、捡货、验货、称重、出库

2.4 库存管理

管理商品库存数量，包括库存查询、库存盘点、库存预警、库存调整、库存同步，等等，库存数据和出库单和入库单关联在一起

2.5 单据管理

包括打印快递单、捡货单、发货单、小票、盘点单、调拨单

3、商家后台

3.1 店铺管理

店铺信息设置、店铺装修、店铺子账号管理

3.2 商品管理

商家后台的商品管理和管理后台的商品管理，是关联起来的

商家可以在这里发布商品、审查商品、商品分组、设置商品状态

3.3 订单管理

用户在电商网站支付之后，订单就会推送到商家后台，商家可以在这里看到订单信息，然后进行发货

3.4 营销管理

基于电商网站提供的营销渠道，比如搜索关键词竞价排名，可以推销自己的商品

3.5 财务管理

与电商网站进行财务结算相关的模块

3.6 用户管理

包括这个店铺的用户信息，以及售后问题处理，都在这里

3.7 数据统计

店铺的经营数据统计，都可以在这里看到

### 2.电商系统整体运行流程

自营商品进销存流程

给自营商品部门开通账号权限。

自营商品部门在供应商管理模块中，录入供应商信息。

自营商品部门在商品管理模块创建自营商品信息。

接着通过采购管理模块，去创建一个采购单，此时采购单会走线下流程，由采购人员跟供应商去沟通，让供应商开始提供货物，供应商会通过物流商将商品运输到我们指定的仓库中去。

采购单会同步到调度中心去，调度中心会创建一个采购入库单，跟WMS系统通信，让WMS系统保存这个采购入库单。

走线下的物流，供应商的货物会运输到我们的仓库里面去，到仓库里之后，仓储工作人员，会负责将这些商品按照调度中心的指示，上到对应的货位上面去，这里要走一个线下的入库流程。

仓储工作人员，在货物都完成入库之后，会编辑一下这个采购入库单，采购入库单会让仓储管理人员去审核。

审核通过之后

一方面会走财务中心进行结算和打款。

另一方面会更新自己本地的商品库存、调度中心的商品库存、库存中心的商品库存，这个库存就可以在网站上看到了 。

此时用户进入电商网站，就可以看到有库存可售卖的商品，同时对商品查看详情页信息，并且下单支付和购买，这里也会走系统的财务管理模块进行资金结算。

当然这里，网站的运营人员通过销售管理模块中的各种促销活动的设置，也可以对一些商品进行促销活动，也可以吸引用户过来购买。

用户下单时，会在订单管理模块中创建一个订单。

创建订单时

需要先从商品管理模块获取商品数据，从促销管理模块获取商品促销数据，从会员管理模块获取会员数据

然后需要对库存管理模块中的商品库存数量进行锁定

接着需要通过物流管理模块来计算运费

最后通过上面所有的数据，可以生成一个订单出来

接着用户对订单确认之后，可以进行支付，通过支付管理模块进行订单支付。

此时订单信息会同步打通WMS系统，创建一个出库单，此时仓储管理人员需要根据创建出来的出库单在仓库中进行出库流程（捡货、验货、称重、出库），然后走线下的物流流程，比如找第三方物流供应商，给他们快递单，让他们发货。

接着用户可以看到这个商品的物流状态，如果与物流系统打通，那么甚至可以查看到整个配送的全过程。

接着物流供应商就会将这个商品发送到用户手上。

如果用户拿到货之后需要退货，那么这个时候需要在网站上申请退货，此时会在客服系统中创建一个退货工单。

接着用户会通过线下物流服务商，将商品寄送回网站。

收到商品之后，售后人员需要验货，并且通过客服系统更新退货商品信息，同意退款，此时通过财务管理模块进行退款资金结算。

同时成功退款之后，售后人员还需要将商品退回仓库，此时仓库收到之后，会再开一个入库单，表明是退货入库，同时也会关联更新WMS的库存数量，以及管理后台库存管理模块中的库存信息。

非常典型的电商三流：信息流、物流、资金流。

如果以前你没搞过电商系统，光是看一些书的话，可能不理解什么是所谓的信息流、物流、资金流。

第三方商品进销存流程

第三方商家通过网站提供的商家入驻申请流程，提交入驻申请。

此时入驻申请会转到管理后台中的商家管理模块中，在这里工作人员需要对入驻商家申请进行审核。

审核通过之后，就会自动为商家创建一个店铺出来，这个店铺里就包含了商家的基本信息。

然后商家就可以设置自己更多的一些信息，包括店铺的装修。

同时商家可以通过商家后台的商品管理功能，发布自己的商品，发布后的商品就会在网站上显示出阿里。

然后用户进入电商网站，就可以看到这些商品，同时下单支付和购买，此时会走财务资金结算，包括了与网站的资金结算，还有与第三方商家的资金结算。

同时这个订单信息会进入到商家后台的订单管理模块中。

商家会看到这个订单，然后从自己的仓储中捡货和发货，通过第三方物流发货到用后手中。

用户收到商品后，如果要申请退货，那么需要点击申请退货，此时会在商家后台的售后管理模块中显示售后信息。

然后用户需要将商品寄送回第三方商家指定的地址中。

第三方商家收到退货之后，需要执行退款，此时会走财务管理模块的结算，将款项退还到用户账号中。

### 3.用户前台功能

网站首页

注册与登录（认证）

搜索结果页

商品详情页

促销活动页

购物车

下单支付

已购买商品（查看发货状态、申请退货）

对商品发表评论

### 4.权限中心

4.1 RBAC权限模型知识

一、权限管理服务

1、整体方案思路

基于成熟的RBAC权限管理模型去做。

账号：其实就是电商公司里所有员工都需要具有的一个账号。

角色：通常是根据部门里的职位来划分，一个部门里的一个职位对应一个角色，比如会员运营、产品经理、售前客服、采购专员，等等。

权限：每个角色都分配对应的权限，权限实际上是3个东西（菜单、按钮、页面链接）。

我这里给大家说一个case，例子，就知道权限管理是干嘛的了

就比如说采购部的采购专员，这是一个职位

电商公司里肯定会招聘对应的采购专员

（1）他应该是根据公司里预定的采购规划和流程，每隔一定时间，就会去采购一些商品。每个季度需要采购一批衣服，或者是什么鞋子，之类的东西

（2）采购专员可能就会去创建采购单，使用采购中心里面的采购管理服务提供的对应的功能

（3）采购单出来之后，他会打印出来那个采购单，然后跟对应的供应商去走线下的采购流程，说我要采购这些东西，你给我发货到什么仓库里面，每个商品采购多少件，采购价格是多少

（4）采购专员会负责维护供应商的关系和数据

他需要使用电商系统里的哪些功能？

可以想到的一点是，他肯定不是说所有的功能都需要使用，同时有权限使用的。比如说订单中心，采购专员，公司里有哪些订单，跟他是没有关系的

所以他是不能去搞这个订单的，查询公司里所有的订单，订单也是属于机密性的数据

采购中心-供应商管理

采购中心-采购管理

所以对于我们来说，权限管理，就是说，对公司里不同部门的员工，你给他一个账号

比如说有个员工叫张三，分配一个账号，用户名一般是英文的，zhangsan。如果公司里有多个叫在张三的人，那么就按照先来后到的顺序，叫zhangsan01，zhangsan02，zhangsan45

给他分配一个角色，叫做，采购专员，一般来说，对这种后台系统而言，角色都是跟部门的岗位相关联的

采购专员，这个角色，我们给分配哪些权限呢？可以访问采购中心-供应商管理，这个菜单，对这个菜单出来的界面中，会有一些按钮，创建供应商，删除供应商，审核供应商，上传采购合同。对这个界面中的一些按钮，也可以分配权限，有没有权限去看到这个按钮。

如果说按照最简单的理解，权限就是菜单和按钮，如果他没权限访问比如说订单中心-订单查询这个功能模块，那么这个菜单他直接就看不到。

如果他没有权限在供应商管理界面中，执行删除供应商的操作，那么他就看不到删除供应商的那个按钮

一个系统，他左侧的菜单栏+界面中的按钮，菜单和按钮，就是电商系统里所有的权限

不同的岗位给分配不同的角色，不同的角色就有不同的权限，可以访问不同的菜单栏和不同的按钮

注意点1：给某个账号分配了一个角色之后，可以在此之外，再额外选择授予该角色没有的权限

用脑海去想象一下，对权限进行增删改查的时候，是要维护一个树形的东西的，比如添加一个子节点，编辑一个子节点，删除一个子节点，每个子节点就是一个权限

如果要控制有些人登录之后，根据权限去显示左侧的菜单栏，树形的菜单，大家可以想象一下，怎么实现：

（1）一个账号登录之后，根据这个账号分配到的角色以及对应的权限，查出来一个权限的集合。看一下里面根权限（父权限ID是NULL），那么就是左侧菜单栏的一级菜单（采购中心）。然后对每个一级菜单，去查询下面的 二级菜单（供应商管理、采购管理）

（2）如果点击了一个菜单之后，会进入一个界面，对界面上的每个按钮，都需要根据是否有这个按钮的权限（添加供应商，ADD_SUPPLIER）去决定是否显示，查到这个账号是否对这个权限（ADD_SUPPLIER）的授权

（3）也许你可以控制不显示出来一些菜单和按钮，但是有些为非作歹的人，也许会直接通过浏览器访问一个URL，来尝试进入某个界面，所以说对所有URL的访问请求，需要做权限控制，看一下他对那个URL是否有权限

每次如果电商后台系统开发好了一个新的功能模块之后，都需要在这个权限管理中进行新增和配置，同时将权限分配给对应的角色

4.2 权限管理

4.2.1权限树查询

需要去对权限进行增删改查，这是一个树形结构，比如：采购中心-供应商管理-添加供应商。

每个权限包含的字段都有：

（1）权限ID

（2）权限编号（比如说PURCHASE，SUPPLIER_MGR，ADD_SUPPLIER），权限的名称（采购中心）

（3）URL（每个权限点击菜单，还是点击按钮，都会向一个URL发起请求）

（4）备注（COMMENT）

（5）类型：菜单/其他（包含了按钮）

（6）父权限ID

根据实际的使用梳理出来对应的一些操作

（1）左侧可以有一个菜单：权限中心-权限管理-权限管理

（2）点击权限管理进入一个界面，看到的是一棵树，此时需要将整颗权限树给查询出来，显示在界面上。权限树的每个节点，要显示的是每个权限的中文名称（编号），采购管理（PURCHASE_MANAGEMENT）

（3）支持这个权限树的一个ajax异步加载，就是刚开始就是查询出来所有的根节点

（4）在前端页面上，点击一个节点，会将这个这个节点下面的直接子节点给查询出来

（5）可以直接在前端界面上，对这颗权限树进行编辑，包括节点的增删改，就是可以对已有的节点，添加根节点，编辑一个节点的信息，删除一个节点；还可以添加子节点；这个全部在前端做，跟我们没有关系

4.2.2 添加根权限

添加根节点：右击这颗权限树上的任意一个节点，出现一个右键菜单，里面可以选择添加根节点，点击之后，会弹出来一个表单，包含了编号、URL、备注、类型三个文本框。点击确定，就可以添加一个根节点。要在权限树里立即显示出来。

4.2.3 添加子权限

添加子节点：右击某个节点，弹出一个右键菜单，选择添加子节点，弹出一个表单，编号、URL、备注、类型，确定，添加一个子节点，同时在权限树种显示出来

4.2.4 编辑权限

编辑节点信息：右击某个节点，弹出一个右键菜单，选择编辑当前节点，弹出来一个表单，此时这个表单需要显示出来这个权限当前的信息，ID、编号、URL、备注、类型，你可以修改权限的信息，确定。就执行修改，同时在权限树里面立即显示出来。

4.2.5 删除权限

删除某个节点：右击某个节点，弹出一个右键菜单，选择删除节点，此时提醒一下，会删除这个节点以下所有的子节点。删除当前节点以及其下所有的子节点。

（6）编辑完权限树之后，可以保存权限树，这个时候，我们需要对权限树进行保存，传递过来一个树形结构一个数据结构。我们需要对这个数据结构去进行遍历，看哪些是新增的节点，要插入；哪些节点被编辑过了，要修改；跟数据库中现在的权限树做一下对比，如果有节点被删除了，我们需要删除那些节点

4.3角色管理

4.3.1 角色列表

角色增删改查/状态的启用和停用

角色包含的一些字段

（1）角色ID

（2）角色编号（PURCHASE_STAFF）

（3）角色名称（采购专员）

（4）备注

（5）是否启用

每个角色，可以分配一些权限

所以需要一个中间表，角色跟权限是多对多的

角色-权限的中间表：ID，角色ID，权限ID

（1）有一个菜单，权限中心-权限管理-角色管理

（2）点击角色管理，进入一个角色列表页面，这个页面里，展示出来角色所有的字段，是支持对角色列表分页查询，支持条件筛选（角色编号，角色名称，状态，默认值，角色编号默认是空/全部，角色名称默认是空/全部，状态默认值是启用，但是可选全部/停用）

4.3.2 添加角色

（3）角色列表上面有一个按钮，叫做“添加角色”，点击按钮，会进入一个添加角色的界面，分成上下两个部分，上面部分是一个表单，在里面可以去填写角色的一个信息，包括了编号、名称、备注、状态；添加角色的界面上，下半部分，还会出来一颗权限树，权限树的每个节点前有一个复选框，在这个树上可以去勾选，要分配给这个角色哪些权限，勾选了一个父权限的话，级联勾选这个父权限下所有的子权限

（4）点击保存，可以执行一个添加角色的操作，此时会保存角色的信息，还会保存角色跟权限的关联信息

4.3.3 编辑角色

（5）在这个角色列表中，最右侧一栏，是操作栏，有编辑按钮，点击之后，会进入一个表单，此时会回显出来角色的信息（编号、名称、备注），以及权限树种会回显已经给角色分配的权限会打钩，在这里可以进行编辑，修改表单中的角色的基本信息，还可以在权限树种，通过勾选的方式，重新给角色分配权限

（6）保存编辑之后，保存角色基本信息，同时保存角色跟权限的新的关联关系

4.3.4 删除角色

（7）在角色列表中，最右侧一栏，有一个删除按钮，点击这个按钮，就可以删除这个角色，就直接将角色和权限的关联关系给删除

4.3.5 启用/停用角色

（8）在角色列表中，最右侧一栏，有启用/停用的按钮，当角色状态是启用的时候，这个按钮显示成停用；当角色状态是停用的时候，这个按钮显示成启用；启用或者停用，就是更新角色的状态

4.4 账号管理

4.4.1 账号列表

（1）账号列表

包含字段：ID、用户名、姓名、创建时间、备注、状态

其实刚才说的那些信息，包括学历，工资卡账号，这些应该是放在组织机构管理模块里的，部门、员工、岗位，都是属于员工信息。每个员工要对应一个账号，账号是不需要保存员工的相关信息的。

组织机构管理模块，我们打算v1.0内测版里不做，做起来比较耗费时间，跟电商的核心业务，关联性不大，我们暂时不做

（2）账号列表

有一个菜单，权限中心-权限管理-账号管理

支持账号列表的分页查询

查询条件：用户名、姓名、角色（下拉框）、创建时间（时间范围）、状态（下拉框）

查询条件的默认值

（1）用户名：空的，默认是全部

（2）姓名：空的，默认是全部

（3）角色：默认是全部，但是可以下拉框选择某个角色，所有角色列表，显示出来角色名称（角色编号），格式

（4）创建时间：默认是空的，就是不限制创建时间

（5）状态：默认是启用状态，可选全部/停用

列表显示的字段，包含了所有的字段

4.4.2 添加账号

（3）添加账号

在账号列表的上面有一个按钮，进入一个界面，分成上下三个部分：第一个部分是显示了一个表单，第二个部分是显示了一个角色列表，第三个部分显示了一颗权限树

表单中的基本信息：用户名、密码、姓名、备注、s状态

在下面的角色列表中，可以给账号分配角色：会出现一个角色列表（ID、编号、名称、备注，要求全部是启用状态），可以分页查询，可以按条件筛选（编号、名称），支持复选，选择多个角色

额外分配权限：在权限树中分配额外权限给账号，随着你勾选不同的角色，会支持将那个角色拥有的权限，在下面的权限树中显示出来。可以额外的去勾选角色权限之外更多的权限。但是如果是勾选角色已有的权限，不允许取消勾选。

点击一个按钮，可以保存账号

在后台，保存账号基本信息，账号跟角色的关联关系，账号跟额外权限的关联关系

4.4.3 编辑账号

（3）编辑账号

基本信息与权限信息，在每一个账号最右侧的操作栏，有一个编辑按钮

进入一个编辑页面，分成上中下三个部分：可以回显所有的数据，表单中显示账号的基本信息（ID、用户名、姓名、备注、状态、创建人、创建时间，但是可以编辑的只有用户名、姓名、备注和状态，其他的字段不可编辑）

中间部分，显示账号的分配的角色，在列表中的复选框会自动勾选已经分配的角色，此时同上，可以搜索，可以重新勾选别的角色

下半部分，显示账号关联的权限树，权限树里的复选框会自动勾选，跟着你重新勾选角色，下面权限树种的权限会自动勾选和取消，然后可以重新勾选额外的权限

然后可以点击确定按钮

保存，账号的基本信息，重新保存账号和角色的关联关系，重新保存账号和额外权限的关联关系

4.4.4 启用/停用账号

（4）启用/停用账号

在最右侧有一个操作栏，里面有修改账号的状态的按钮，如果账号是启用状态，那么显示停用按钮，如果账号是停用状态，显示启用按钮。点击按钮后，修改账号的状态。

4.4.5 修改密码

（5）修改密码

在最右侧有一个操作栏，修改密码按钮，点击后弹出一个输入框，可以修改账号的登录密码

4.4.6 删除账号

（6）删除

在最右侧有一个操作栏，点击删除按钮，会将账号，账号和角色的关联关系，账号和权限的关联关系，全部删除

4.5 权限控制

4.5.1 菜单权限控制

（1）在左侧菜单栏，先查出来一个账号关联的所有权限中的顶级权限（父权限ID为NULL），再查出来每个顶级权限下面，这个账号有权限的二级权限，两级的左侧菜单就可以显示出来了。左侧菜单栏，进入的时候，自动递归查询出来账号有权限的所有类型为菜单的权限树，可以显示成左侧的菜单栏。

4.5.2 按钮权限控制

（2）点击一个菜单，跟着URL进入一个界面之后，界面中会有很多的按钮。要求每个按钮对应一个权限，是否显示这个按钮，要根据用户是否有这个权限，来决定，是否要显示这个按钮。的时候，需要根据按钮对应的权限的编号，去后台查一下，那个账号是否拥有某个权限，是这个编号的

4.5.3 URL请求权限控制

（3）所有的URL请求，要过滤一下，在这个账号授权的权限中，是否某个权限的URL是这个URL，账号是否有权限访问这个URL

子系统-服务-模块-功能，这样的一个结构

4.6 系统安全服务

4.6.1 操作日志管理

二、系统安全服务

菜单：权限中心-系统安全-操作日志

1、业务知识

每个账号在执行各种操作的时候，都会访问后台系统的URL，账号对这些URL的访问，就是操作日志，可以存储下来，以后如果对一些非法的员工，可以去审计他的行为，看他都在干什么

2、操作日志的数据字段

ID、账号ID、IP地址、URL、权限ID、操作时间、是否授权（是/否）

3、添加操作日志

就是说账号在访问所有的URL的时候，都会去添加一条这个操作日志，插入一个表中

4、查看操作日志

显示的列表字段：ID、账号ID、用户名、姓名、IP地址、权限名称、权限编号、权限URL、操作时间、是否授权

可以筛选，账号ID、用户名、姓名、IP地址、权限名称、权限编号、权限URL、操作时间范围、是否授权（下拉框）

这个版本暂时不做，以后的版本肯定是要做的，以后再迭代

4.6.2 黑名单管理

菜单：权限中心-系统安全-黑名单

1、业务知识

可能会受到一个攻击，或者不明的ip在访问我们的URL

2、查看黑名单列表

ip地址、备注

3、对黑名单进行增删改

4、黑名单的控制

黑名单中的ip地址，所有的访问一律封禁

### 5.商品中心

1、电商商品的业务知识

专业的电商系统里，商品、订单、支付、库存，这几块都是很复杂的。

SKU：Stock Keeping Unit，最小库存单位，最小的商品单位，比如iPhone 7 Plus 128G 银色，就是一个SKU。

Apple iPhone X (A1865) 64GB 深空灰色 => SKU，SKU一定是可以唯一定位到一个实际的商品上的。

Apple iPhone X，它是一个SKU吗？没法唯一定位到一个具体的商品上，它的不同配置的手机，有不同的颜色，有不同的内存，你只有选择了一个颜色+内存，才可以唯一定位一个iphone x的手机。

SPU：Standard Product Unit，产品单元组合，比如iPhone 7 Plus，就是一个SPU，其实类似一个商品的概念吧。但是iPhone 7 Plus是不能具体指代哪个商品的，因为iPhone 7 Plus有很多种，比如不同的内存大小+不同的颜色，就可以组成不同的手机。

我们一般来说，所说的一个商品，我们指的是什么呢？说的是一个SPU，我们都会说，我要买一个iphone x，我们一般不会说要去买一个深灰色32GB的iphone x。

SKU也可以叫做一个商品，SKU和SPU之间的关系，具体的一个商品，可以定位到一个实体的这么一个商品。

比如iPhone 7 Plus这个SPU为例，有6种颜色（金色、白色、黑色、玫瑰金、银色、亮黑、红色），3种内存大小（32G、128G、256G），所以这个SPU下的SKU有6 * 3 = 18种组合。比如说iPhone 7 Plus 玫瑰金 32G，iPhone 7 Plus 红色 128G，这就是2个SKU。

一个SPU下，有4个SKU，颜色（深空灰色、银色），内存（64G，256G），2 * 2 = 4种组合，4个SKU。

深空灰色+64G，是一个具体的手机。

深空灰色+256G，是一个具体的手机。

银色+64G，是一个具体的手机。

银色+256G，是一个具体的手机。

通常我们说的商品，实际上就是一个SPU。

采取的是类似天猫的那种方式，就是一个商品详情页，显示一个SPU。通过参数的组合选择，可以让用户自己选择和唯一定位一个SKU。

不同的电商，都不一样，业务层面。

类目：就是SKU所属的分类。

属性：关键属性、销售属性、非关键属性、导购属性，4种。

关键属性是能唯一确定一个商品的属性，比如说之前提到的手机，那么关键属性可能就有屏幕尺寸、型号，这个是可以唯一确定一个商品的，也就是一个SPU，比如说iPhone 7 Plus，7 Plus就是个型号，这就是一个关键属性，可以确定一个商品了。

iPhone 7 Plus，关键属性，2个，品牌（Apple），型号（iPhone 7 Plus） => 可以定位出来一个SPU。

销售属性，是说确定一个SKU的属性，比如手机的销售属性，就有颜色、内存，比如iPhone 7 Plus 128G 土豪金，就可以确定一个SKU了 => 用来定位SKU。

非关键属性，就是除了关键属性和销售属性之外的其他属性，比如手机就有摄像头像素、接口类型（USB），等等很多。

导购属性，可以用来在商品列表页中作为筛选条件的。

那么我们这里可以想象一下，在京东、淘宝等电商详情页中，看到的是什么？实际上看到的单位就是一个SPU，然后我们需要对这个SPU，对它的销售属性选择对应的值，相当于就是选择了一个具体的要购买的SKU。

而这个SPU，它的关键属性，就确定了它自己本身是一个SPU；销售属性是在商品详情页由用户来选择的；非关键属性实际上是一个SPU的所有SKU都共享的，都是一样的，实际就是所谓的商品规格；导购属性就是这个SPU的可用来进行导购筛选的属性，可以是关键属性、销售属性、非关键属性，都可以。

然后的话呢，是这样的，类目实际上也是一个树形的结构。

父类目（服装） -> 子类目（女装） -> 叶子类目（连衣裙）。

就是这个类目，一般就是3~4层，就可以了，不要层级太多，甚至在前台显示的时候，可以省去第一季的类目，就显示第二级和第三级的类目。

然后每个叶子类目，会关联一堆属性（4种属性）。

在添加商品的时候，给这个商品选择一种叶子类目，然后就会让你输入对应的属性值。

就举个例子吧，比如说，电子产品 -> 手机 -> 智能手机。

比如说，智能手机这个叶子类目，就关联了一堆的属性。

（1）关键属性：品牌，型号

（2）销售属性：颜色（红色，白色，蓝色，土豪金），存储容量（4G，8G，16G，32G，64G）

（3）非关键属性：拍照功能（摄像头像素、摄像头类型、视频显示格式），显示（屏幕尺寸、触摸屏类型、分辨率），网络（网络类型、网络模式）

（4）导购属性：存储容量、网络类型、摄像头像素

我们在创建一个商品的时候。

选择一个类目：电子产品 -> 手机 -> 智能手机。

输入一个品牌：Apple

输入关键属性：品牌（Apple），型号（iPhone 7 Plus）。

输入销售属性：销售属性不输入，因为在商品详情页上展示的时候，是展示SPU，但是这里要选择每个销售属性可选的值。颜色（白色、土豪金），存储容量（16G，32G，64G）。

非关键属性：输入所有属性的值，拍照功能（摄像头像素 -> 双1200万，摄像头类型 -> 三摄像头，视频显示格式 -> 4k），显示（屏幕尺寸 -> 5.8英寸，触摸屏类型 -> 电容屏，分辨率 -> 2436 * 1124像素），网络（网络类型 -> 无需合约版，网络模式 -> 无需合约版）。

导购属性：不需要输入的。

商品名称：苹果X【6期免息/当天发】送壳膜Apple/苹果 iPhone X 全网通手机。

你会发现什么，商品的核心数据，基本都出来了。

这个基础类目很重要，比如说手机就是一个基础类目，同时这个基础类目有多个属性（前摄像头像素、后摄像头像素、屏幕尺寸、网络制式），选择一个手机类目，同时输入多个类目属性的值，就可以唯一确定一个商品；再比如说一个裤子类目，类目属性就是腰围，裤长，面料材质，厚度

类目是一个大的类别，但是光有类目不行啊，决定这个类目下一个唯一商品，需要使用类目对应的多个关键属性的值，来确定一个商品

属性有不同的类别，有关键属性、非关键属性，销售属性，导购属性。关键属性，比如手机的品牌和型号，衣服的品牌和货号，都可以唯一确定一种商品，定位一个SPU；基本属性就是显示在商品规格中的普通属性；销售属性是指的比如衣服的多种颜色，多种尺码，算是一个商品的不同型号，可以唯一定位一个SKU，一般显示在商品信息那块；导购属性，是可以用在商品列表页，进行筛选的属性，可以看一下商品列表页

这里说一点，分类的属性，是只能选择已经有的属性的，选择的同时，可以勾选是否必填，属性分组。属性分组的概念，就是将多个属性分为一组，比如商品规格里面，就分为了多个组，随便找个商品看看，然后在分组里可以增删改查属性

这里还有一个属性继承的概念，比如对类目A有1个属性；类目B是类目A的子类目，有1个属性；类目C是类目B的子类目，也有1个属性；那么如果最后在类目C下创建SKU，则会包含1+1+1=3个属性，这是一个属性继承的概念

类目树可以管理，每个类目管理的属性，可以通过较为复杂的前端操作去关联

每个类目可以直接关联属性，也可以关联属性组（每个属性组里关联多个属性），关联每个属性的时候，需要给属性选择类型（支持多选）

类目之间的属性继承关系

父类目，比如电子产品，有一个属性（操作系统）；手机，有一个属性（机身颜色）；智能手机（触摸屏类型）

实际上，在智能手机下面添加商品的时候，是会让你输入三个属性的（操作系统+机身颜色+触摸屏类型）

做一点特殊说明

两种类目：前台类目，后台类目

后台类目：可能是3级的，服装 -> 女装 -> 连衣裙

前台类目：不想给那么多的层级，希望让用户更好的去选择，女装 -> 连衣裙

如果商品按照多层级的后台类目在前台进行展示，那么可能很用户搜索的时候就太麻烦了，可能比如在后台类目有3个层级，在前台类目就只要2个层级，此时就需要单独维护一套前台类目，然后跟后台类目进行关联映射

前台分类管理：分类节点新增/编辑，分类节点排序，分类商品聚合（按基础类目、按品牌、按属性）

前台类目，一样就是一棵树，不用维护属性；主要是将前台类目，每个层级的类目，都要关联到一个后台的类目上去

2、属性管理

1、属性列表

属性的增删改查。

这块就是对属性进行管理，先要有属性信息，包括了名称和描述，以及输入方式（多选，输入），如果是单选/多选，需要给出对应的几个选项。

ID、名称、描述、输入方式（多选、输入）、可选值范围

ID

名称：机身颜色

描述：手机机身的颜色

输入方式：多选

可选值范围：白色、蓝色、红色、土豪金、灰色

菜单：商品中心-属性管理

属性列表页面，显示所有的字段，支持分页查询，支持筛选条件（名称，默认值是空）

2.新增/编辑属性

新增属性，在列表页面上面，有一个按钮，是新增属性的按钮，点击按钮，可以弹出来一个新增界面，表单（名称、描述、输入方式（多选/输入）、可选值范围（如果是多选，那么可以添加多个可选值）），确定，保存属性即可

列表页面最右侧一栏，有一个编辑按钮，点击编辑按钮，出来一个表单，回显（名称、描述、输入方式、可选值范围），所有的字段都可以编辑，确定，保存属性即可

3.删除属性

列表页面最右侧一栏，有一个删除按钮，点击删除按钮，可以将属性删除。如果有类目还关联着属性，不能删除属性。

3、类目管理

1、类目树查询

类目的字段：ID、名称、描述、是否为叶子类目、父类目ID

菜单：商品中心-类目管理

进入界面，显示一颗类目树（默认加载所有根节点，可以点击每个节点异步加载子树）

2.添加根类目

添加根节点：右击弹出右键菜单，选择添加根类目，弹出一个表单，输入名称、描述、是否为叶子类目（是/否）。

在弹出的界面中，有一个区域，可以为类目维护对应的属性分组，点击一个按钮，就可以在一个弹框里输入属性分组的名称，下面表格里就出来一个新的属性分组。接着对属性分组，我们可以再点击一个按钮，可以在弹出的列表里，选择某个属性（可以按照属性名称进行筛选），选择了一个属性之后，这个属性就会跟这个属性分组关联起来。

直接给类目关联属性，在另外一个区域里，可以直接点击一个按钮，添加一个属性，弹出来属性列表，可以筛选，选择属性

维护属性的时候，需要对这个属性选择对应的所属类型，可以支持多选，关键属性，销售属性，非关键属性，导购属性。一个属性可以是多种类型，比如可以是销售属性，同时也可以是导购属性

还可以对每个属性维护一个属性是否必填的下拉框

3.添加子类目

添加子节点：右击弹出右键菜单，选择添加子类目，弹出一个表单，输入名称、描述、是否为叶子类目（是/否）。可以维护属性分组和属性，同上。保存之后，关联子类目和父类目的关系

4.编辑类目

编辑节点信息：右击弹出右键菜单，选择编辑类目，弹出一个表单，回显名称、描述、是否为叶子类目（是/否）。同时需要回显这个类目关联的属性分组以及属性，可以对属性分组和属性进行调整，比如说可以修改属性分组的名称，可以对某个属性分组里的属性添加，或者是删除。保存之后，可以更新类目的信息。

5.删除类目

删除类目：右击弹出右键菜单，选择删除类目，则级联删除所有子类目，以及类目和属性分组，以及属性的关联关系。如果有商品关联着类目，不允许删除当地前这个类目。

4、品牌管理

1.品牌列表

品牌的增删改查

这里的信息包括了：ID、中文名、英文名、别名、logo（图片）、品牌介绍、品牌授权凭证（图片）、状态、所在地、备注

（1）商品中心-品牌管理

（2）品牌列表：ID、中文名、英文名、别名、状态、所在地，支持分页，支持筛选（中文名、英文名、别名、所在地、状态（默认是启用，可选全部/停用））

2.新增品牌

新增品牌：品牌列表上面有一个按钮，点击后弹出一个表单，包含了除ID以外的所有字段，每个字段都可以输入，logo、品牌授权凭证是要上传图片的，状态是下拉框（启用/停用）

3.编辑品牌

编辑品牌：品牌列表右侧栏，有一个按钮，编辑。弹出来一个表单，回显所有的数据，可以编辑所有的属性。

4.删除品牌

删除品牌：品牌列表右侧栏，有一个按钮，删除。点击后，删除这个品牌。如果有商品关联这个品牌，不允许删除品牌的。

5.启用/停用品牌

启用/停用品牌：品牌列表右侧栏，有一个启用/停用按钮。如果状态是启用，那么按钮是停用；如果状态是停用，那么按钮是启用。点击后，可以修改品牌的状态。

5、商品管理

菜单：商品中心-商品管理

1.商品列表

列表字段：类目、品牌、商品编号、商品名称、商品状态、所属仓库、库存数量、库存状态、采购价、参考价、促销价

筛选条件：类目、品牌、商品编号、商品名称、库存数量范围、参考价范围

操作栏：编辑、审核、上架/下架、删除

支持分页查询

2.新建/编辑商品

维护好了基础数据，包括属性，类目，品牌，就可以编辑商品了

商品从创建到上架可以售卖，是有一个流程的

商品新增编辑，就是在商品列表的上面，有一个按钮，点击后进入商品新增/编辑的界面

商品信息

类目：弹出来一颗类目树，在一颗类目树中去选择一个对应的叶子类目，商品只能是属于叶子类目的，非叶子类目下是不能挂商品的

品牌：弹出来一个品牌列表，在一个列表框中，可以去选择一个品牌，Apple。支持对列表分页，支持筛选（中文名、英文名、别名、所在地、状态（默认是启用，可选全部/停用））

商品编号：每个商品都有一个编号

商品名称：输入，苹果X【6期免息/当天发】送壳膜Apple/苹果 iPhone X 全网通手机

商品副名称：输入，当天发 送壳膜 咨询客服不分期价格直降

毛重：输入，100g

商品状态：选择下拉框，核待审、待上架、审核未通过、已上架、已删除

外包装长：50cm

外包装宽：100cm

外包装高：200cm

服务保障：这里其实是可以去选择的。但是我们简化一下，就直接输入。碎屏无忧，全国联保，正品保证，极速退款，赠运费险，7天无理由退换，可开发票

商品图片：上传商品的一些图片

商品描述：一般是富文本编辑框，图文混排，插入图片，插入文字。图文混排，有大段大段的文本，也有很多张图片。将商品描述里的图片单独存放在一个表里面，将商品描述中的图片都给替换为一个<image src="访问一个后台接口">，然后在显示商品描述的时候，到<image>那儿，会动态请求后台，后台从数据库中读取出来那张图片给显示出来。

一大段文本

图片1

一大段文本

图片2

一大段文本

图片1和图片2，给写到一个单独的表中

然后对商品详情内容做一个替换：

一大段文本

图片1的<image src="/image/235">

一大段文本

图片2的<image src="iamge/236">

一大段文本

就会存储到一个表中，存储到一个clob字段里面去，大文本的

包装清单：

采用 Lightning 接头的 EarPods 1 件

iPhone 1 件

Lightning 至 USB 连接线 1 件

5W USB 电源适配器 1 件

Lightning 至 3.5 毫米耳机插孔转换器 1 件

类目属性值（输入选择的类目的各个属性的值，注意，这里实际就是输入关键属性值和非关键属性值，是一个SPU共享的，但是SKU的销售属性是对每个属性都选择多个值，比如有哪集中颜色，哪几种内存大小）

输入关键属性：品牌（Apple），型号（iPhone 7 Plus）

输入销售属性：销售属性不输入，因为在商品详情页上展示的时候，是展示SPU，但是这里要选择每个销售属性可选的值。颜色（白色、土豪金），存储容量（16G，32G，64G）

机身颜色，提供的可选值范围是：红色、蓝色、白色、黑色、金色

你此时需要选择你的这个商品在这个属性中，可选的值是哪些？白色、黑色

非关键属性：输入所有属性的值，拍照功能（摄像头像素 -> 双1200万，摄像头类型 -> 三摄像头，视频显示格式 -> 4k），显示（屏幕尺寸 -> 5.8英寸，触摸屏类型 -> 电容屏，分辨率 -> 2436 * 1124像素），网络（网络类型 -> 无需合约版，网络模式 -> 无需合约版）

换一个角度，反过来去想一下，如果是编辑商品的时候，回显这个商品对应的所有属性的值，如何回显呢？肯定是去查商品关联的那个品类，查那个品类直接关联的属性，查这个品类关联的那个属性对应的值。

运费模板（选择物流运费模板，比如是包邮/按重量/按件，后面下订单计算运费的时候都是根据运费模板来计算的），从物流中心加载出来的一个运费模板的下框

机身颜色：黑色，白色

内存容量：64G，128G，256G

这两个销售属性就已经输入好了可选的值

sku1：黑色，64G

sku2：黑色，128G

sku3：黑色，256G

sku4：白色，64G

sku5：白色，128G

sku6，白色，256G

此时一旦选择好了所有的销售属性，会自动出来一个SKU的列表，每个SKU的列表，就显示每个销售属性的值，你可以手动删除某一个SKU（比如有白色+64G，但是实际上可能并没有这个东西，你可以手动删除这个SKUs）。针对SKU级别去设置下面几个属性。

sku编号

库存（所属仓库（石家庄仓库，无）、库存数量（0件）、库存状态（是否有库存，无库存）、最低预警库存（1000件））

每个sku的库存数据，会被保存到库存中心去，不会保存在商品中心的表中，商品和库存会分开，库存是不断变化，而且是快速变化，所以这块要放到单独的库存中心去。但是商品本身的数据变化是比较少的，放在商品中心。

商品价格（采购价（8000元）、参考价（8500元）、售价（关联会员体系，不用的会员级别不同的价格，1级会员是8500元，2级会员是8450元，3级会员是8400元，4级会员是8350元，5级会员是8300元）、促销价格（8100元））

所有信息全部填好之后，就会保存商品数据；如果是编辑的话，要回显所有的数据，提供我们来编辑，编辑过后更新数据。

特别说明：在选择好销售属性的值之后，会自动出来各个销售属性排列组合出来的SKU，对每个SKU，可以具体设置对应的SKU编码、价格和库存；但是也可以对这个SPU设置统一的库存和价格（一期简单一点，就做统一SPU设置库存和价格）

商品每次新增和编辑完之后，状态会变为待审核。

只有商品处于待审核、已下架、审核不通过的状态，可以进行编辑。

3.商品审核

在商品列表中，最右侧一栏，可以选择审核商品。进入一个商品审核的界面，在界面里，显示商品的所有数据，不可编辑的，最后有两个选择，通过/不通过。需要由商品部门的管理人员对这个商品的内容进行审核，内容以及售价。只有商品处于待审核的状态，才能执行审查操作。如果审核通过了，就会将商品状态变为待上架；如果审核不通过，那么商品状态变为审核不通过。

4.商品上下架

在商品列表中个，最右侧一栏，可以选择上下架。审核通过之后，商品的上架和下架。只有商品处于待上架，会显示一个商品上架的按钮，点击后，状态修改为已上架；商品处于已上架的时候，按钮会显示为商品下架，点击后，状态修改为已下架。

5.商品删除

最右侧一栏，有一个删除按钮，点击后，会将商品相关的数据全部删除了

### 6.采购中心

1.供应商管理

1.供应商信息管理

菜单：采购中心-供应商管理-供应商管理

CRUD

新建供应商、供应商列表

供应商信息

（1）基本信息：供应商名称、公司名称、联系人信息（公司地址、联系人、电话）、供应商类型（自营、第三方）

（2）结算信息：报价币种、结算方式（预付款、账期（月结算，周结算，季度结算））、结算账户（银行名称、银行账号、开户名称）、开票信息（名称、银行、纳税人识别号、联系电话）

（3）经营范围：品类、品牌（这个是从商品中心去选择的，类目和品牌的基础数据）

（4）其他：备注、公司资质信息、启用状态

（5）合同资料：合同资料信息（合作合同、商品协议价合同、采购合同）、每个合同到期时间

支持的操作

供应商列表，显示字段（供应商名称、公司名称、公司地址、联系人、联系电话、供应商类型、状态），支持分页，支持筛选（供应商名称，公司名称，公司地址，联系人，供应商类型（下拉框，目前只支持一个第三方），状态默认是启用（可选全部/停用）、供应商评级）

（1）新增供应商，列表上面有一个新增按钮，进入新增页面，显示出来一张大表单，包含了上面的几个部分，所有的信息，都可以输入。

（2）编辑供应商，列表右侧操作栏中，有一个编辑按钮，点击后进入编辑页面，回显所有的数据，然后可以编辑和保存。

（3）启用/停用供应商，列表右侧操作栏中，有一个启用/停用按钮，如果供应商状态是启用，那么按钮是停用；如果供应商状态是停用，那么按钮是启用；点击后修改供应商的状态

（4）删除供应商，列表右侧操作栏汇中，有一个删除按钮，点击后删除这个供应商即可。

（5）查看交货记录列表，点击每一个供应商的供应商评级（ABCD），进入一个页面，交货记录列表（采购单编号、采购日期、预计交货日期、交货仓库、交货日期、良品率、是否缺货）

2、供应商绩效管理

菜单：采购中心-供应商管理-供应商绩效管理

产品质量、交货期、交货量，简化一下，采取3个指标来评估一个供应商的等级。

就是每次供应商发货到仓库的时候，仓库工作人员都会去验货，都会对这次商品的入库单，加一个确认的一个过程，输入产品质量（良品率）、交货期是否如期（有没有延期）、交货量（如否量是准确的，没有缺货）。

这个每次交货的确认记录，会回传导供应商管理的模块中，会存储下来每个供应商的交货记录，作为后面对供应商等级进行考评的一个依据。

A、B、C、D

每隔3个月，都对供应商最近3个月内的交货记录，进行考评，比如说给一个权重。

每次交货都是100分，产品质量占到了40%，交货是否如期占到了30%，交货是否足量占到了30%。

就是可以通过产品良品率 * 40分，拿到一个分数；交货是否如期，30分全拿，延期1天，扣10分，延期3天，全部扣光；按照交货的足量率，我要采购100件衣服，你给我发来了80件，80%的分数，30分 * 80%， 24分。

对最近3个月每次交货都打一个分数，最后将每次交货的分数算一个平均分出来。

就是这个供应商最近一个季度的分数。

按照分数的范围给供应商评级，100分是A级；90分是B级；80分是C级；80分以下都是D级。

这是一个后台模块，负责供应商绩效的计算

2.采购业务流程

供应商的菜单，采购中心-供应商-供应商管理，采购中心-供应商-供应商绩效管理。

有一个菜单，采购中心-采购-采购管理，进入一个界面，看到一个采购单的列表，点击一个按钮，创建采购单。

采购单：供应商，商品，仓库。

采购部的工作人员创建一个采购单，输入了采购单的内容，此时状态是编辑中；接下来，采购人员可以对采购单多次修改，感觉差不多，都完善了以后，可以对采购单提交审核；此时状态是待审核；也可以在这个阶段取消采购单，那么状态就是已取消。

采购部的主管对采购单进行审核，状态可以是已审核，如果审核不通过则回到编辑中的状态。

通过审核之后的采购单同时会发送给供应商，供应商根据采购单将商品运输至仓库。

采购单同样会发送给调度中心，调度中心会生成采购入库单，然后下发给WMS系统。采购入库单中，包含了，告诉这个仓库，包含了采购单所有的数据，然后更重要的是，要根据仓库中的每个货位的剩余容量，去将每个商品去分配到对应的货位中去。

比如说采购单里有一个商品：iPhone 7 Plus 128G 土豪金，采购价格6000元，采购数量1200台。

然后在采购入库单中，会对商品的入库进行调度，会看一下这个商品的采购数量，比如说是1200台，那么一个货位的存储容量假设是600台。

这个时候，采购入库单中，会将一个商品拆分为两个。

iPhone 7 Plus 128G 土豪金，采购价格6000元，采购数量1200台，上架数量600台，货位是A01-1-01。

iPhone 7 Plus 128G 土豪金，采购价格6000元，采购数量1200台，上架数量600台，货位是A01-1-02。

就是说，做的比较好的电商系统，它都是至少要保证说，商品入库和出库，都是要关联具体的货位的。入库的时候知道放哪个货位，出库的时候知道从哪个货位去取。这个过程就是调度中心在干。

供应商发货到仓库，仓库收到商品之后，仓储工作人员，需要进行验货：抽查商品质量、输入到货日期、检查商品数量。

此时采购入库单的状态是编辑中，然后仓库工作人员可以对采购入库单进行编辑，输入上面的三个数据，点击保存，此时还是编辑中的一个状态。

同时仓库工作人员需要对照着采购入库单，进行验货、入库、配货、上架等仓库操作，完成实际的入库操作。

仓储工作人员完成商品上架之后，对入库单提交审核，由仓储管理人员进行审核。当入库单状态变为待审核之后，会同步将采购单的状态变为待入库。

在入库操作完成之后，接着入库单需要由仓库管理人员进行审核，审核通过之后，状态变为已入库，同时采购单的状态也变为已入库；如果审核不通过，则状态变为编辑中。

接着财务人员需要进行结算，WMS系统会同步跟财务中心通信，发送已入库的采购入库单过去，然后财务中心基于入库单创建一个采购结算单，此时状态是编辑中；如果此时取消，那么结算单状态变为已取消。

采购结算单包含了哪些数据：包含了采购单的核心数据，总金额，商品金额，物流费用，还会从供应商管理模块中查询出来对应的一些结算数据。

然后财务人员可以对结算单进行编辑（币种、结算比例、账期时间、是否开票），编辑之后状态变为待审核，同时入库单和采购单的状态都变为待结算。

财务管理人员需要对结算单进行审核，审核通过之后变为已审核，然后系统自动发起财务结算，结算单变为已完成；审核不通过则回到编辑中状态。

结算单变为已完成之后，入库单和采购单的状态都变为已完成。

除了走上述流程之外，在入库单完成之后，就是审核通过之后，会依次更新库存，包括仓库库存，调度库存，销售库存。

仓库里面，一旦入库单审核通过之后，会更新自己仓库里的库存，两个维度：商品总库存，每个货位的商品库存。

向上更新调度中心里的库存，也是一样，每个仓库的商品库存，每个货位的商品库存。

继续向上，更新库存中心里的库存，这块是不管仓库的，就是商品的总库存。

3.采购退货流程

采购退货流程实际上就是一个可逆的流程，跟采购流程是类似的，从采购部发起采购退货；然后WMS系统安排物流进行退货，有出库单；最后是财务收到退款结算

4.采购单管理

1、采购单列表

采购开单的时候，主要是选择如下的数据：

（1）供应商：从供应商管理模块中获取，主要是获取到供应商列表，选择一个供应商，从谁那里进货。

（2）收货仓库：从WMS系统中获取仓库列表，选择一个要收货的仓库。

（3）商品信息：从商品中心获取数据，列表，你可以添加要采购的多个商品，每个商品是从商品中心获取的一个下拉列表（可以按照文本搜索）去选择商品，单位是SKU，包含了sku编码、商品名称、规格，同时输入每个商品的采购数量和采购价格（ 默认是采用的创建商品的时候输入的采购价格，但是这里可以修改的）。

（4）添加商品的方式：点击一个添加按钮，然后弹出来一个商品列表，里面可以根据分类、品牌、sku编码、商品名称几个选项去筛选商品。商品列表显示的字段包括：sku编码、商品名称、规格、分类、品牌。

（5）其他信息包括：预计到货时间、联系人、联系电话、联系邮箱、备注。

采购单列表页的字段

（1）采购单基本信息：采购单编号、采购员、供应商、收货仓库

（2）状态：采购状态、入库状态、结算状态

（3）采购商品：SKU种类数量、总数量

（4）金额：总金额、商品金额、物流费用

（5）其他：预计到货时间、备注

（6）操作列：编辑，提交审核

支持分页

支持筛选

（1）采购单ID

（2）采购员（下拉列表，默认是全部，从权限中心拿账号数据）

（3）供应商（下拉列表，默认是全部）

（4）收货仓库（下拉列表，默认是全部）

（5）采购状态（下拉列表，编辑中/待审核/已审核/待入库/已入库/待结算/已完成）

（6）入库状态（下拉列表，编辑中/待审核/已入库/待结算/已完成）

（7）结算状态（下拉列表，编辑中/待审核/已完成）

2.新建采购单

采购单列表上面，有一个按钮，采购开单，进入一个界面，显示下面的输入项

（1）供应商：下拉列表，从供应商管理模块中获取，主要是获取到供应商列表，选择一个供应商，从谁那里进货

（2）收货仓库：下拉列表，从WMS系统中获取仓库列表，选择一个要收货的仓库

（3）其他信息包括：预计到货时间、联系人、联系电话、联系邮箱、备注

（4）商品信息：商品列表。

每次添加一个商品，点击按钮，弹出来一个商品选择列表，从商品中心获取数据。

你可以添加要采购的多个商品，每个商品是从商品中心获取的一个下拉列表（可以按照文本搜索）去选择商品，单位是SKU，包含了类目、品牌、sku编码、商品名称、关键属性、销售属性，支持根据类目、品牌、sku编码、商品名称进行筛选，支持分页。

此时可以勾选一些商品，勾选完以后，点击确定。

此时在采购单的商品列表里，会多出来一个商品，显示的就是商品的类目、品牌、SKU编码、商品名称、关键属性、销售属性、采购数量、采购价格。

这里重点是要对选择的每个商品输入采购数量和采购价格（ 默认是采用的创建商品的时候输入的采购价格，但是这里可以修改的）

循环往复，为采购单添加多个要采购的商品。

（5）新建了一个采购单之后，采购单的状态，应该是编辑中

3.编辑采购单

编辑功能同上，就是说，在采购单列表的右侧操作栏中，有一个编辑的按钮，点击之后进入编辑界面，在界面里面，回显所有的数据，可以去编辑这些数据，然后再保存和修改。

编辑之后，采购单的状态就是编辑中

4.提交审核

在采购单列表的右侧操作栏中，有一个提交审核的按钮，点击一下之后，将采购单的状态变为待审核。只有编辑中的采购单，可以提交审核。

5.审核采购单

在采购单列表的右侧操作栏中，有一个审核的按钮，点击一下之后，进入审核界面，在审核界面中，显示采购单完整的一个数据，最后有两个选项，通过/不通过，由采购部的高级人员来进行审核。

审核不通过的话，状态就还是编辑中，审核通过了以后状态变为已审核

此时，采购中心，会将采购单发送到调度中心，由调度中心去将采购单调度到对应的仓库中去，变为采购入库单。

6.更新采购单状态

1、采购入库单变为待审核

当WMS中的采购入库单状态变为待审核之后，采购单的状态会变为待入库

2、采购结算单变为待审核

当采购结算单进入待审核状态之后，那么WMS中的采购入库单也会变为待结算，同时会通知自己将采购单的状态变为待结算

3、采购结算单变为已完成

当采购结算单变为已完成之后，会通知WMS将采购入库单变为已完成，同时WMS会通知自己将采购结算单也变为已完成

### 7.WMS（仓储管理系统）

1.仓储业务知识

主要是调度中心会负责跟WMS系统进行交互，电商系统其他服务都是跟调度中心进行交互。

实际上来说，电商的系统，WMS系统，仓储管理系统，有几种情况，可以是那种C/S架构的，安装在仓库里面的，第三方提供的专业的仓库管理系统。

我们开发的电商系统可以跟WMS进行通信即可。

但是这里呢，我们采取的是我们自己开发一套WMS系统，WMS系统，我们做成什么架构的。

B/S架构，C/S架构。

B/S架构：每个仓库的管理人员，直接通过一个浏览器，就可以看到自己的仓库里面的一些数据和信息，包括其他仓库的一些数据。

C/S架构：需要在每个仓库里面去安装，一般就是只能看到自己的仓库里的一些数据。

B/S架构：假设认定为，我们这个B2C电商，WMS系统自己开发，B/S架构，可能我们本来就没几个仓库，假设我们搞了几个重要的仓库。石家庄仓库、杭州仓库、广州仓库，负责发货到全国各地。

然后呢，每个仓库的人，都可以看到所有仓库里面所有的数据。

下面讲解一下比较重要的一些概念

（1）仓库：管理仓库信息，CRUD。

（2）货位：每个仓库里面，要去管理货位的信息，CRUD，（我们可以想象一下，货位是什么，每个仓库里划分成了很多排货架，一般是分成一排一排的，比如A排；每一排有多个货架，比如A01货架；每个货架有多层，每一层有多个货位，比如A01-1-01）。

（1）入库：采购入库、退货入库、调拨入库，等等。

（2）出库：销售出库、调拨出库，等等。

每次一批商品入库，都会关联一个货位，或者是多个货位。

每次商品要出库的时候，拣货单多会关联一个货位，然后方便仓库工作人员直接到对应的货位去拣货。

2.仓库信息管理

对仓库信息进行增删改查。

仓库信息的字段：ID、仓库编号、仓库名称、仓库地址、联系人、联系电话、启用状态、备注、支持的发货省份（对不同省份有不同的优先级）。

3.货位信息管理

进入一个货位的列表，上面肯定有一个下拉框，是仓库下拉框，默认选中了一个仓库，显示的是某个仓库的货位列表。

在这个货位列表中进行CRUD。

提供货位的增删改查功能，包括的字段有：

所属的仓库ID、货位编号（A01-1-01）、创建人、创建时间、启用状态、存放总容量（简单一点，就按照件数来算好了，一般来说这块会更加的复杂，可能是按照商品的体积）、剩余容量。

我们可以想象一下，实际上后面讲到在采购商品的时候，你采购了一批商品，然后呢，那批商品，在调度中心里面，调度中心会负责去进行商品入库的调度，就是说，采购了1万件衣服。

调度中心会看一下当前每个货位的剩余容量，每个货位最多可以放1000件衣服。

调度中心会按照一定的规则，将1万件衣服，分配到10个货位中去，每个货位放1000件衣服。

4.采购入库单管理

1.线下商品入库流程

（1）到货确认：在商品到了仓库之后，可以进行到货确认。

（2）验货打码：检查商品是否合格，同时进行打印出商品条码，贴在商品上。

（3）商品上架：按照先进先出的原则，将商品分配和上到对应的货位上去。

上面说的几个步骤是线下实际上在仓库里执行的商品上架的一个流程。

2.创建采购入库单

调度中心将采购入库单，同步到WMS系统，WMS系统负责将采购入库单保存起来，此时采购入库单的状态是编辑中

3.采购入库单列表

菜单：WMS-采购入库单

显示哪些字段呢？跟采购单列表，保持几乎一样就可以了。但是状态那一栏，就显示采购入库单自己的状态就ok了。此外，要额外加的3个字段，一个采购入库有一个总的到货时间，同时采购入库单中每个商品，需要有一个良品率和到货数量。

还要包含一些额外的字段：创建时间、操作人、最近一次操作时间、审核人、审核时间

4.编辑采购入库单

对采购单中相关的数据是不能修改的，唯一能编辑的就是下面的内容

可以输入这批货物总的一个到货时间，输入每个商品的良品率、到货数量

商品上架信息列表的编辑，在采购入库单中，可以编辑一个列表，这个列表中，每次你点击一个按钮，就可以跳出来一个框，这个框可以让你选择一个采购入库单中的某个商品

选择了这个商品之后，这个商品会出现在入库货位列表中，对这个列表中的这个商品，可以输入对应的商品上架数量，货位（弹出来一个列表，可以筛选货位，按照货位编号去筛选，选择一个货位）。

比如你要采购的一个商品是

iphone8 plus 银灰色 64G 1000

商品上架信息

iphone8 plus 银灰色 64G 500 A-01-1-01

iphone8 plus 银灰色 64G 500 A-01-2-03

5.提交审核

在采购入库单列表右侧的操作栏中，有一个提交审核的按钮，只有编辑中的状态可以点击这个按钮，点击之后将采购入库单的状态变为待审核，此时同时会通知采购中心将采购单的状态变为待入库。

6.审核采购入库单

在采购入库单列表的最右侧，有一个审核按钮，只有对待审核的采购入库单，可以点击。点击之后进入一个审核界面，在界面中，显示所有的数据。采购单数据，3个交货数据，商品上架数据。仓储管理的负责人，在里面需要去进行审核，选择通过/不通过。

如果审核通过

更新状态

（1）将采购入库单的状态变为已入库

（2）同时通知采购中心，将采购单的状态变为已入库

更新库存

（1）更新自己本地仓库商品的可用库存加1

（2）更新自己本地每个货位每个商品的可用库存加1

（3）通知调度中心，将调度中心里的商品库存加1，货位商品库存加1

创建采购结算单

（1）创建这个采购结算单，这里的话呢，就是直接根据采购入库单的所有数据，但是剔除掉商品上架数据，但是要包含这里的3个额外数据

（2）将采购结算单，同步到财务中心去

7.更新采购入库单状态

1、采购结算单进入待审核状态

当采购结算单进入待审核状态之后，财务中心会同步状态过来，将采购入库单状态修改为待结算，同时修改完采购入库单的状态之后，需要再次往上通知采购中心，将采购单的状态修改为待结算

2、采购结算单进入已完成状态

当采购结算单进入已完成状态时，会通知自己，将采购入库单的状态变为已完成。同时自己要通知采购中心，将采购单的状态也变为已完成。

5、销售出库单管理

1.线下商品出库流程

一个用户下了一个订单，这个订单的不同的商品会被调度中心，调度到一些仓库里去发货，此时仓库工作人员会收到一个销售出库单，调度中心也标识出了，哪些商品从哪个货位上面去出库，发货。

（1）调度

锁定库位，跟物流公司进行通信，申请发货物流单号，然后为订单分配一个物流单号。库位锁定的原则是先进先出，商品入库上架的时候也是先进先出的，这样可以保证商品发货的顺序性。这里是什么意思，假如说我们2017-01-01进了1万件衣服；2017-02-01又进了1万件衣服；发货的时候，先进先出，优先发2017-01-01进的衣服。这里锁定的是货位库存，就是每个货位这个商品有多少库存。

这块其实是在调度中心做的，这个信息已经设置在销售出库单中了

（2）打单

打印发货单、物流单。你平时网上购物的时候会发现有2个单子。发货单是放在包裹里面的，告诉你本次发货了哪些东西；物流单是贴在包裹上面的。

发货单，实际上是调度中心直接就给创建好了。

物流单，是调度中心跟第三方物流厂商的系统进行通信，直接申请了一个物流单。

调度中心，发货单（发了哪些商品，商品清单），物流单（哪个物流商，运送到哪儿），商品出库单（调度，从哪个仓库，发送哪些商品，从哪些货位去拣货，物流商是谁）。

（3）捡货

根据销售出库单中调度好的哪些商品从哪个货位发货s

女士羊毛衫，从货位A01-2-05，去拿2件。

男士袜子，从货位A05-5-09，去拿10件。

就是工作人员推着捡货车去捡货，然后捡货之后会扣减锁定的货位库存。

（4）复核

对捡货完成的订单进行核对，确保发货单、实物商品、物流单的统一。

（5）包装

对复核完的商品进行打包和称重，发货单放包裹里面，物流单贴包裹上面。

（6）交接发货

根据物流单将打包好的商品推送到仓库里面，仓库外面，跟物流公司的交接区，接着物流公司会按照物流单去进行发货。在线下的一个销售出库的这么一个过程。

我们这次，第一个版本，重点做WMS的仓库管理、货位管理、采购入库、销售出库、退货入库。

2.创建销售出库单

WMS系统接收到调度中心发送过来的销售出库单、发货单、物流单，然后全部保存到本地，状态是编辑中欧。接着其实，仓库的工作人员，只要在系统里查看到有心的销售出库单，就需要去按照销售出库中的指示，去完成一整套线下的出库流程。物流厂商就开始发货了。

唯一的一点区别，就是销售出库单包含了每个商品的出库条目，另外销售出库单新增了一个字段：发货时间。

3.销售出库单列表

每一行，每个销售出库单，显示的是一个汇总的数据：订单编号、收货人信息、配送信息、付款信息、发票信息、商品数量、商品总金额。还要在包含一些执行销售出库的线下流程中对应的一些数据：创建时间、操作人、最近一次操作时间、审核人、审核时间、复核人、物流单号、发货时间、销售出库单的状态。

显示的列表内容基本跟订单列表保持一致即可，订单列表是如何显示的，我们这里销售出库单列表页如何显示就可以了，只不过新增一个字段，发货时间。而且销售出库单列表要加上商品出库条目，货位 -> 商品 -> 多少件。

4.编辑销售出库单

在走完线下流程之后，负责出库的人，需要在销售出库单中编辑一下对应的验货复核人、发货时间。列表页的右侧操作栏中，有一个编辑按钮，只能对编辑中的销售出库单进行编辑。

5.提交审核

然后线下的商品出库流程走完之后，完成了销售出库单的编辑，里面加入了谁负责验货的复核，发货的时间，就会提交审核的按钮。在列表页的右侧操作栏中有一个提交审核的按钮。执行之后，将销售出库单的状态变为待审核。

6.审核销售出库单

只有对待审核的状态的销售出库单，可以点击列表页右侧操作栏中的审核按钮，进入一个审核界面。包含了销售出库单、发货单、物流单，所有的信息和数据。可以去执行审核操作：通过/不通过。

审核通过后

（1）销售出库单的状态变为：已完成

（2）通知财务中心给物流商打款，这次的一个物流费用。其实这块也可以做成跟供应商一样的，那种定期打款，但是我们这里简化一下，就做成审核后直接打款。

（3）通知订单中心，将订单的状态修改为待收货

6.退货入库单管理

1.创建退货入库单

调度中心将退货入库单发送过来，此时退货入库单基本包含了订单所有的数据，同时包含退货工单的部分数据（退货的原因和备注），总的到货时间，每个商品条目有一个合格数量、到货数量，退货商品的上架条目。同时有自己独有的一些字段：创建时间、操作人、最近一次操作时间、审核人、审核时间、状态

此时状态：编辑中

2.退货入库单列表

退货入库单列表显示哪些字段：其实跟订单列表保持基本一致即可，同时包含退货原因。同时包含退货入库单自己特有的一些数据：创建时间、操作人、最近一次操作时间、审核人、审核时间、状态。此外，

此外，还包含了一些特殊的数据：一个是总的一个到货时间；每个商品，都有良品率，比如说一个订单中，有用户购买了5个iphone，此时要检查一下，iphone中质量过关的有几个；收到了几个商品，比如说购买了5个iphone，此时收到了4个？5个？

上面说的那3个额外的数据，也是需要在退货入库单列表中要显示的

3.编辑退货入库单

仓库的工作人员，接收到了退货入库单之后，会等待这个退货商品寄送到仓库里来。接收到商品之后，就会去执行质量检查，执行完之后会填写上面说的那些数据。另外一个就是工作人员此时会执行一个线下的上架流程，他会自己根据先入先出的原则，将退回来的商品，上到对应的货架中去。

此时工作人员，还需要退货入库单中填写商品上架的数据：哪个商品，商品名称，上了几件，到哪个货位中去。

综上所述，工作人员一边执行线下的操作，一边线上填写退货入库单

4.提交审核

线下执行完了退货入库的操作，同时编辑完了线上的退货入库单之后，在退货入库单列表页的右侧操作栏中，可以点击“提交审核”。此时退货入库单的状态变为：待审核。

5.审核退货入库单

可以有人去审核退货入库单，在退货入库单列表页的右侧操作栏中，如果状态是待审核，可以点击审核按钮，进入一个审核页面中，会显示退货入库单完整的一个记录。可以选择通过/不通过。

如果审核通过：

（1）将退货入库单的状态修改为：已完成

（2）通知客服中心，将退货工单的状态，修改为：已完成

（3）通知财务中心，进行退货打款，将订单支付的金额退还到用户的账户中

（4）更新仓库本地的仓库商品的已出库库存减1，可用库存加1；仓库货位中的商品库存，已出库库存减1，可用库存加1

（5）通知调度中心更新库存

（6）通知会员中心，将会员成长值减去对应的一个订单金额*10%的成长值，扣减积分

7.库存调拨管理

我在这里这么说一句，我们这个系统是分版本的，第一个版本，我们就完成核心的功能，每个模块，中心，会员、促销、WMS、支付、订单、商品，我们都留一些业务模块，到后面去做。

为什么呢？

因为后面，在进入微服务架构之前，我们要给大家用真实的多模块同时十几个人，并行开发真实的业务需求，迭代业务需求，此时互相之间排期冲突、上线冲突、代码冲突，等等各种问题。

单体应用的话，十几个人，同时给十几个模块加功能，排期不一样，上线时间布一样，测试时间布一样，大量的冲突，导致互相等待，迭代效率低下。

==> 微服务架构，优雅，漂亮，引出来。

还有另外一个，其实是什么呢？我们预留一些功能模块，到后面可能要讲解某个具体的技术，或者是架构的时候，专门来引入那个业务功能，基于那个特殊的业务功能来讲解某个架构。

促销模块，秒杀，促销活动，优惠券 ==> 秒杀，是放到后面去讲的，是为了讲解瞬时超高并发架构去讲解的。

仓内调拨：将部分商品从一些货位里调拨到其他一些货位，让货位负载均衡，方便拣货。

仓间调拨：从一个仓库调拨部分商品到另外一个仓库中。

仓库工作人员进行调拨单开单，此时状态是编辑中，编辑后调拨单状态变为待审核。调拨单中需要选择要调拨的商品以及数量。

调拨单的信息包括：调出仓库（下拉框选择），调入仓库（下拉框选择），物流公司，物流单号，备注信息，然后就是添加商品，商品列表包括了sku编码、商品名称、规格、可调拨数量（该仓库的库存）、调拨数量、调出货位、调入货位（下拉框选择）。

调拨单的列表包括了以下的字段：调拨单号、调拨单状态、调出仓库、调入仓库、商品种类、调拨开单量、已出库总量、已入库总量。

仓库管理人员对调拨单进行审核，如果审核通过，则状态变为已审核；如果审核不通过，则状态回到编辑中。

审核通过的调拨单，会分配给对应调出仓库的工作人员处理，此时调出仓库的工作人员，可以根据分配过来的调拨单，创建调拨出库单，调拨出库单开单之后，状态是编辑中，保存之后变为待审核，同时此时调拨单的状态变为待出库。

仓库管理人员需要对调拨出库单进行审核，审核之后状态变为已出库，同时调拨单的状态变为已出库，同时仓库开始进行调拨的线下物流操作，往调入仓库运输。

调入仓库接收到运输过来的商品之后，根据调度出库单创建一个调拨入库单，此时状态是编辑中，编辑过后，状态变为待审核，此时调拨单的状态变为待入库。

调入仓库管理人员对调拨入库单进行审核，审核之后，入库单状态变为已完成，调拨单的状态也变为已完成。

同时这个时候开始执行商品入库的操作，包括验货、称重、上架，等等。

8.库存盘点管理

如果线下入库出库流程与线上的入库单以及出库单不相符，那么可以进行库存盘点，盘点之后可以自动生成盘盈入库单和盘亏出库单。

仓库工作人员，创建盘点单，此时状态是编辑中，编辑之后，状态变为待审核。

这里选择要盘点的仓库，同时添加仓库里的sku商品进去，商品列表字段包括了：sku编码、商品名称、规格、货位、库存数量。

盘点单列表字段包括了：盘点单号、盘点单状态、仓库、商品种类、备注。

仓库管理人员，对盘点单进行审核，审核通过之后，盘点单状态变为待盘点；审核不通过，盘点单状态变为编辑中。

接着仓库工作人员开始对盘点单进行录入操作，就是要盘点的商品的实际库存数量，录入结束之后，盘点单状态变为已完成。

接着系统自动对盘点单中的系统库存数量以及实际盘点库存数量进行比对，如果库存数量一致，则保持盘点单状态为已完成，会生成盘点盈亏表。

如果库存数量不一致，比如实际库存数量比系统库存数量要少，此时要自动生成盘盈入库单；如果实际库存数量比系统库存数量要多，此时要自动生成盘亏出库单。

此时可以将盘盈入库单发给供货商，让他们补货；也可以根据盘亏出库单，通过线下物流向供应商退货。

9.仓库库存管理

1.提交订单

提交订单之后，订单中心通知调度中心操作库存，调度中心通知WMS操作库存。调度中心会直接通知WMS，仓库中商品的可用库存减1，锁定库存加1，仓库货位中商品的可用库存减1，锁定库存加1。

2.支付订单

用户支付订单之后，订单中心会通知库存中心更新库存，库存中心通知调度中心更新库存，调度中心通知WMS更新库存。此时将仓库商品的锁定库存减1，仓库商品的已出库库存加1；将仓库货位商品的锁定库存减1，将仓库货位商品的已出库库存加1。

3.取消订单

将仓库商品的锁定库存减1，将仓库商品的可用库存加1；将仓库货位商品的锁定库存减1，将仓库货位商品的可用库存加1。

### 8.会员中心（用户注册和登录）

1、业务知识

1.总结

跟大家说一下，我们之前已经讲完了：商品中心、WMS、采购流程（采购中心、调度中心、WMS、财务中心、库存中心）。

到这一步为止，我们已经可以实现什么效果呢？

1、我们可以在商品中心里面创建一些商品出来

2、我们可以在WMS中维护仓库和货位的数据

3、我们可以通过采购中心作为入口，发起商品的采购，实际的货物会进入仓库，商品的库存会在销售层（库存中心）->调度层（调度中心）->仓库层（WMS）会全部更新

4、此时商品是有库存的

5、然后我们可以走之前商品中心说过的，对商品发起审核，审核通过之后可以进行上架

后台一系列的准备商品的过程，就结束了。

我们就可以作为一个普通的用户，从网站首页进来，开始执行一系列的行为，最终付钱购买网站中售卖的商品。

不同的网站，概念不同

有些网站是说，你注册进来是用户，还不是会员

有些网站的理念是说，注册即会员，给你开通了一个会员你的账号，后面你可以围绕着你的会员， 去做各种事情，你的会员成长值的积累，会员积分，都是跟着你的会员账号关联的

所以我这里采取的是第二个理念，注册即会员

2.用户注册

（1）用户名

（2）密码

（3）重复输入一次密码

（4）手机号

（5）验证码

（6）手机验证码

用户注册的流程是什么呢？填好前面的信息，然后点击按钮获取手机验证码，再输入。一开始我们做的简单一些，尽量减掉繁琐的枝叶。到后面，包括支持手机验证码，我们都会做。邮箱的验证。

点击立即注册按钮，就可以完成注册，你的一个账号就有了

3、用户登录

1、支持微信/QQ的直接登录，第三方账号登录

2、用自己的账号去登录

（1）输入手机号码

（2）输入用户名和密码即可

2、每天第一次登录

会员的成长值+5分，会员积分+5分

### 9.商品中心（查询部分）

1、业务知识

首页

商品筛选列表页

商品搜索结果页

商品详情页

搜索，直接按照商品标题进行like搜索，然后按照销量、评论数量、好评度、上架日期，来排序

搜索之后进行的列表页，或者是点击分类进入的列表页，都可以进行筛选

2.电商首页

我们照着京东来分析一下，电商的首页包含些什么东西，我们不可能做一个京东电商首页出来 。

我们抽取一些常见的通用的一些东西，来设计我们的这个首页，要展示的数据。

（1）左侧的品类列表

（2）上面的搜索框

（3）中间的滚动广告

（4）每个品类的热门商品

建议直接前端做死，用户进来，访问咱们的域名，直接进入一个静态的html页面，里面都是死的。不是说查询我们后台接口，拿到首页要展示的数据的。

3.商品搜索

要买个东西，有很明确的诉求，比如说你就是要买iphone 7 plus。此时你是不会走左侧的分类导航栏的，会直接在上面的搜索框中输入iphone 7 plus，你要购买的商品的名称。搜索结果会进入商品列表页面。

（1）搜索，按照关键词来搜索，怎么搜？不支持全文检索，仅仅支持like模式的匹配

（2）对匹配的结果，可以进行分页查询

（3）不支持对匹配的结果列表页，进行进一步的条件筛选

4.品类导航

我现在想买一个手机，但是我不知道要买什么型号，我只是知道我要买一个手机而已。此时你是不会在搜索栏中输入的，一般就会在左侧的品类导航栏中，去点击一个品类。然后会进入那个品类的商品列表页。

（1）点击某个类目之后，进入一个商品列表页

（2）需要根据这个类目动态取出来当前每个导购属性的值集合，显示成筛选条件

（3）可以对商品列表页进行进一步的筛选，以及分页查询

5.滚动图片

我们简化为，我们的网站就是会显示top 10热门的商品，来回滚动，点击一下直接进入那个商品的详情页。

6.每个类目的热门商品

第一次进网站，你是可能没什么特别的购物的目的，你没有想好要买什么，更没想好具体要买什么商品，进了网站就是来随便逛逛的。此时会浏览首页，往下拉，看每个热门品类有哪些热门商品。就可以直接点击商品，进入商品详情页。

7.商品列表页

通过商品搜索，或者是类目导航，都会进入一个商品列表页，此时可以支持根据各个商品的导航属性的属性值，去进行筛选，支持分页查询

8.商品详情页

从商品列表页中点击一个商品，或者是首页的滚动广告/类目热门商品，点击，就会进入商品详情页

（1）商品名称

（2）商品副名称

（3）商品售价

（4）配送至

（5）销售属性

（6）库存数量

（7）规格（非关键属性，属性组）

（8）包装清单

（9）售后保障

（10）商品图片

（11）商品描述

（12）促销活动

### 10.购物车

购物车关联的系统包括了3个：商品中心、库存中心、促销中心、物流中心

每次购物车展示的时候，都会从商品系统里面查询数据，从库存系统里面查询库存，从促销系统里面查询促销信息

比较好的一种方式，是将购物车持久化，也就是说，将用户和商品的购物车关联关系，落地存储到数据库中去，那么下次用户再次登录的时候，无论隔了多久，都可以将购物车还原回来

1.加入购物车

在商品详情页，点击按钮，将一个商品加入购物车中。

2.查看购物车

显示了加入购物车的商品列表。

购物车中的每个商品，包含的数据：

商品缩略图、sku编号、商品名称、销售属性、商品价格、商品毛重、商品长宽高

购买数量（可以调节）、商品总价（前端界面，自动计算的，购买数量 * 商品价格）

商品库存、配送区域内仓库是否有货、库存是否足够（前端自动比较和显示的，要购买的数量跟当前库存相对比）

促销活动列表（可以选择某一个促销活动）

操作栏（删除）

商品列表的右上方，计算出了这些商品的运费

商品列表的右下方，计算出了商品的总价，商品价格 + 商品的运费

要求，购物车是离线购物车，需要持久化永久性存储用户的购物车的数据，每次用户重新下次再登录的时候，需要将购物车中的数据再次展示出来的

3.购物车结算

点击一下结算按钮，就会进入一个准备提交订单的确认页面，但是点击这个按钮的时候，需要去现场校验一下，库存是否足够，如果库存不足够的话，是不允许提交这个订单的

### 11.支付中心

初期就做的比较简单了，支付模块每次支付的时候，都是调用第三方支付平台，然后更新虚拟资金账户，同时更新订单状态，就可以了。

1.第三方支付对接

调用第三方支付平台接口

（1）显示出来第三方支付的一个界面，比如说用户名/密码/支付密码，或者是二维码

（2）接收请求，完成对应的支付操作

2.支付交易流水

交易流水号（第三方平台生成），创建时间，完成时间，订单号，费用信息（订单总金额、优惠金额、应付金额）。

交易渠道信息：交易渠道（支付宝、微信），渠道账户，执行支付的时间，渠道返回的支付订单号，渠道返回的状态码（错误码和错误信息）。

支付用户信息：用户类型、用户账号（有人用支付宝来支付，我们可以拿到他的支付宝账号在给我支付）。

支付状态：支付成功，支付失败，已退款。

3.支付对账

每隔一段时间，比如一天，一天的凌晨，向第三方渠道系统请求下载日账单，或者是月账单，然后跟自己记录的交易明细进行比对，看账目是否一致。

日对账，周对账，月对账。

### 12.订单中心

1.业务知识

1、业务知识

（1）订单有哪些东西

订单信息：记录订单信息

订单流程：包含订单生成到完成的全流程

订单状态：订单各个状态的流转

订单推送：订单状态变化时，需要推送订单告知关联方

订单管理：订单查询、与WMS交互

（2）订单的状态

几种状态：待付款、待发货、待收货、交易成功、已取消、售后中、交易关闭。

（3）订单包含的信息

用户信息：用户账号、用户等级

订单基础信息：订单编号、订单状态

收货信息：收货地址、收货人姓名、联系电话、邮编

商品信息：SKU、规格、商品数量、价格、商品图片、商家

优惠信息：优惠券、促销活动、虚拟币抵扣金额

支付信息：支付方式、支付单号、商品总金额、实付金额、运费、优惠券优惠金额、总优惠金额

物流信息：物流公司、物流单号、物流状态

其他信息：发票信息

（4）订单的价格计算

订单实付金额=商品金额（SKU金额合计）+运费-总优惠金额

总优惠金额=促销活动优惠金额+优惠券优惠金额

2.提交订单

1.订单确认页

在提交订单的确认页面中，需要显示一些数据

（1）收货人列表，可以选择一个收货人+收货地址+联系电话（从会员中心去查询的）

（2）选择一个支付方式：仅仅支持支付宝/微信（写死的）

（3）商品列表：选择使用的促销活动、商品缩略图、sku编号、商品名称、销售属性、商品价格、商品毛重、购买数量、库存数量、库存是否充足（从购物车点击结算的时候，将界面上的购物车数据，直接给带到了这个页面中来）

（4）赠品处理：还需要走订单系统的后台接口，去附加这个赠品信息，给订单补充一些赠品的数据，只不过将赠品的价格设置为0即可（走后台接口，去处理赠品信息）

（5）可以填写订单备注

（6）可以填写发票信息，填写发票的类型、抬头、纳税人识别号、内容

（7）可以选择是否使用优惠券（从促销中心加载这个会员领取的优惠券列表）

（8）显示价格明细：总价、运费、促销折扣、优惠券折扣 -> 最终算出一个总价格（商品总金额 - 促销折扣 - 优惠券折扣 + 运费）

点击提交订单按钮，就可以提交订单

2.生成订单

在订单确认页中，填写好了所有的订单的信息之后，价格都计算好了之后。

此时，你要购买的那些商品的数据，他们对应的那个订单就已经生成了，此时会有一个订单号出来，告诉你这个订单要支付多少钱，24小时内完成支付，否则系统自动取消订单。下面给出来你选择的支付方式的支付页面，支付宝/微信，扫码支付。

（1）接收到生成订单的请求之后，需要去在保存订单数据之前，需要去检查库存是否足够。这里是直接检查库存中心的可销售库存是否足够，因为库存中心、调度中心、WMS三层的库存理论上是一模一样的，所以此时就检查一个库存中心的库存即可。如果可销售库存充足，则进入下面的流程。

（2）保存订单的数据，生成订单号

（3）执行锁定库存的操作：那么首先是订单中心要通知库存中心，商品的可销售库存减1，商品的锁定库存加1

（4）保存一条订单操作日志，类型：生成订单

3.订单列表

下单时间、订单号。

订单中包含的商品列表：缩略图、商品名称、购买数量、收货人姓名、总金额、应付金额、订单状态（未付款的时候，叫做等待付款）、跟踪物流、查看订单详情、操作栏（取消订单、付款）。

4.订单详情

（1）订单号、订单状态（等待付款）

（2）订单的操作日志记录：你对订单做的所有的操作，都会记录订单操作日志流水

（3）收货人信息（收货人、地址、手机号码）、配送信息（配送方式、运费）、付款信息（支付方式、总金额、促销活动抵扣、优惠券抵扣、应付金额）、发票信息（发票类型、发票抬头、纳税人识别号）

（4）商品列表：缩略图、sku编号、商品名称、销售属性、商品售价、购买数量

（5）订单总金额、运费、促销活动折扣、优惠券折扣、应付总金额

5.取消订单

1.手动取消订单

（1）更新订单状态，点击按钮后，选择一个取消原因，订单状态变为：已取消

（2）释放锁定库存，无论是哪种情况，进行了订单的取消之后，就需要将订单对应的之前的库存进行释放。订单中心需要去通知库存中心，让库存中心释放库存。

（3）新增一条订单操作日志，类型：手动取消订单

2.自动取消订单

（1）系统后台线程，自动追踪每个订单，如果是超过24小时没支付的订单，系统直接自动取消

（2）更新订单状态，状态变为：已取消

（3）释放锁定库存，无论是哪种情况，进行了订单的取消之后，就需要将订单对应的之前的库存进行释放。订单中心需要去通知库存中心，让库存中心释放库存。

（4）新增一条订单操作日志，类型：自动取消订单

6.订单支付

（1）完成支付本身的事情，用户需要支付订单金额到我们的账号里去。先显示出来第三方支付的页面（二维码），完成支付操作，支付中心会去记录支付交易流水

（2）更新订单的状态：待发货

（3）更新订单中的商品相关的库存：通知库存中心，更新商品的库存

（4）接着将订单同步到调度中心，由调度中心去调度订单中的商品的发货

（5）将订单支付金额*10%，累加到会员的成长值以及积分，调用会员中心的接口

（7）新增一条订单操作日志，类型：支付订单

7.更新订单状态

1.订单完成发货

WMS系统那边，确认订单完成发货之后，就会发送通知过来，通知订单中心：

（1）将订单状态修改为待收货

（2）新增一条订单操作日志，类型：商品发货。

2.退货工单审核不通过

如果退货工单审核不太通过的话，会通知订单中心：

（1）件订单状态变为：交易关闭

（2）新增一条订单操作日志，类型：退货审核不通过

（3）更新订单退货记录的状态：审核不通过。

3.退货工单审核通过

如果退货工单审核通过了，那么会通知订单中心：

（1）将退货记录的状态变为：待寄送退货商品

（2）在退货记录中更新对应的退货收货人，退货收货地址，退货收货人的联系方式

（3）新增一条订单操作日志：退货审核通过

4.确认收到退货商品

客服中心的客服收到退货商品之后，会做一个初步的检查，如果确认ok，会点击确认收到退货商品，此时会通知订单中心：

（1）将退货记录的状态更新为：退货待入库

（2）新增一条订单操作日志：确认收到退货

5.退货入库单审核通过

wms中心完成退货入库，同时退货入库单审核通过之后：

（1）需要将订单的状态修改为：交易关闭

（2）新增一条订单操作日志，类型：退货已入库。

将订单退货记录的状态更新为：退货已入库

6.财务中心完成退货打款

财务中心在接收到wms中心的退货入库的通知，同时完成退货打款之后，会来通知订单中心：

（1）将退货记录的状态更新为：完成退款

（2）新增一条订单操作日志：完成退款

8.查看物流进度

可以调用物流中心的接口，对物流进度进行查看

9.确认收货

1.手动确认收货

用户收到货之后，拆包满意，那么可以在订单列表中自己手动点击确认收货，此时：

（1）就会将订单的状态改变为：已完成。

（2）新增一条订单操作日志，类型：手动确认收货。

2.自动确认收货

系统对处于待收货状态的订单，会自动定期检查每个待收货订单是否签收，如果第三方物流商的反馈状态是已经签收了，然后超过7天用户没点击确认收货，系统自动确认收货。

（1）订单状态变为：已完成。

（2）新增一条订单操作日志，类型：自动确认收货。

10.申请退货

1.执行申请退货

在订单列表页面，如果是处于已完成状态的订单，可以点击申请退货的按钮。然后会进入一个界面：

（1）要求你选择退货原因

（2）输入退货的备注

（3）后台新增一条订单退货记录，状态为：待审核

（4）订单状态变为：售后中

（5）通知客服中心创建一个售后工单

（6）新增一条订单操作日志，类型：申请退货

2.查看退货进度

用户肯定时不时过来看看的，此时如果状态为售后中，可以点击状态进入一个页面，在页面里，会显示：

（1）当时用户选择的那个退货原因，以及填写的退货备注

（2）同时给出一个审批结果

（3）如果是审批通过的状态，此时会显示出来需要用户将商品寄送到公司的某个地址（地址、收件人、联系方式）

3.填写退货物流单号

用户在寄出之后，需要在这个页面里填写对应的物流单号

（1）在退货记录中保存快递单号

（2）将快递单号同步到客服中心的退货工单中

（3）将退货记录的状态修改为：退货商品待收货

（4）新增一条订单操作日志：已寄送退货商品

11.未来可能需求

1.线下订单管理

订单查询：订单搜索，条件筛选（订单时间，订单状态，订单来源，订单字段范围）

订单新建：主要是针对的线下大宗订单，不是用户自己下的，可能是电商网站的大宗商品交易部门的员工为大客户下的

包括了选择用户、设置收货地址、选择商品（分类、品牌、SKU、名称）、价格和数量设置、支付（客服支付，在这之前用户可能已经将货款打了过来了）

包括了补发订单（输入原订单号，选择商品），换货订单（输入原订单号，更换商品）

2.订单售后

用户退货：用户点击退货申请，客服进行退货审批，系统生成退货入库单并且同步到WMS系统，用户寄件并且输入快递单号，WMS收货入库，客服提交退款申请给财务，财务确认退款

用户换货：用户点击换货申请，客服进行换货审批，系统生成换货入库单并且同步到WMS系统，用户寄件并且输入快递单号，WMS收货入库，客服手工生成换货订单

3.其他功能

订单审核：用户黑名单过滤（系统），异常订单预警（系统），订单财务风险审核（财务，针对线下大宗订单）

订单转发货单：主要是针对之前说的线下大宗订单，手工创建订单之后，需要通过这个功能，将订单转为发货单，包括发货单创建/编辑（收货人信息、商品信息、发票信息），发货单同步到WMS系统，WMS同步发货单状态到系统（打印->拣货->配货->包装->称重->出库->在途->签收->缺货）

订单取消：如果发货单未拣货，可以提交取消申请，进行发货单拦截（同步通知WMS系统），进行取消审批，退款

订单时常监控：订单状态节点异常时长监控设置，异常订单预警

12.订单价格计算

1.价格计算说明

这块，主要是在商品进入订单确认页面的时候，根据当前使用的优惠券，或者是促销活动，进行订单最终价格的一个计算

在订单确认页面，需要走一个价格计算的服务，动态的根据当前的促销信息，计算出每个商品实际要支付的价格

先判断订单里每个商品是否参加了促销，然后看下本地订单中是否满足了促销条件，最后根据促销规则计算出商品的最终价格

1、订单中心会将整个订单，发到商品中心的价格服务里，让它去完成订单以及其中各个商品的价格的计算

（1）价格服务，会从促销中心中，将所有的促销活动的数据查询过来，然后进行统一的计算

2.促销活动计算

满减促销：满100减10、满300减50、满500减80

满赠促销：满300元送自拍杆，满500送充电宝，满1000送高端耳机

单品促销：促销期间商品售价直接打折，比如6折

套装促销：A商品50元，B商品80元，一起购买只要120元，便宜10元

多买优惠促销：买2件9折，买3件8折，买4件7折

赠品促销：购买某个商品可以赠送别的商品

一共买了3个商品：A商品是100元，B商品是300元，C商品是250元，650元

如果某个商品选择了单品促销

直接对这个商品的价格进行折扣，打指定的一个折扣，比如说某个商品，B商品，8折，240元

A商品是100元，B商品是240元，C商品是250元，590元

如果某个商品选择了套装促销

此时需要对订单中结成套装的商品，看一下，如果组成了一个套装的话，此时可以给一个总的优惠价格，A + B = 300元，比如A原来是100，B原来是240，套装是300 => 优惠分摊，40块钱，按照比例分摊优惠，扣减金额。100 - 100 / 440 * 40 = 90.91，A商品；340 - 340 / 400 * 40 = 309.09，B商品

如果某个商品选择的是多买优惠促销

会看一下，这个商品一共购买了多少件，如果达到了指定的件数，说可以打折，看一下具体按照规则，可以打几折

这个时候，每个商品的价格都降低了，有上面3种促销活动的商品价格，都降低了

满减促销，看一下选择满减促销的某个商品，这个商品的金额是否达到了一个满X元的条件，如果达到了，就对商品的价格减去Y元。比如C商品是180元，选择了满300件50的活动，C商品一共购买了2件，360元 - 50元 = 310元。

假设这个时候，A商品是90.91，B商品是309.09，C商品是180，加起来的总和 = 580元

满500减80，580 - 80 = 500元，省了80元钱，按照比例分摊

到此为止。。。。价格就算完了，总的优惠价，每个商品的优惠分摊价格，都出来了

（3）赠品的处理

然后就是处理促销

看一下，如果有某个商品选择的是买赠，此时会在订单中加入一个商品，只不过金额是0元，很多电商，多出来一个商品，只不过金额是0元

满赠，满多少元赠一个赠品，看一下此时单个商品的金额，如果达到一定的金额，可以赠送商品，在订单里再加入对应的赠品。比如说某个商品是100元，选择的是满180赠一个小耳机的活动，买了2件，200元，就给赠送一个商品。

3.优惠券计算

如果这个用户有一个有效的优惠券，在订单确认页面下面可以显示一个优惠券下拉框，你可以选择这个订单要使用一个优惠券

进来会直接去计算，在计算完促销活动的基础之上，会自动给你去应用那个券，折上折。现金券，直接抵扣；满减券，看整个订单满多少元，给减多少元。

还有一个，在购物车每个商品的下拉框中，单品折扣优惠券，跟其他的那些促销活动互斥，只能选择一种

### 13.物流中心

1.运费模板管理

1.业务知识

这块，主要是电商网站走第三方物流发货出去，这个过程，该如何进行管理，主要是与第三方物流系统的对接，包装物流状态的查询

在用户下单的时候，需要根据选择的运费模板进行运费的计算，然后收取运费。接着在仓库里出货的时候，需要选择物流配送公司，推送订单给物流公司，然后还要跟踪物流公司的运输状态，最后还要跟物流公司进行结算和对账

这个就是要提供不同的运费模板，比如说固定运费10元、满X元包邮、自定义规则

可以创建运费模板，包括运费模板名称、计费规则（固定运费/满X元包邮/自定义规则）

如果是固定运费和满X元包邮，那么就比较简单了，包括在计算运费的时候，就判断订单最后实付金额就可以了

但是很多常用的是自定义规则，就是说定好一个距离

比如发送到附近几个省，在多少重量以内，是多少钱，一个固定价，接着每增加多少重量会增加多少钱；对再偏远的省份，又是一套计算规则，多少重量以内是多少钱，加多少重量会加多少钱

运费的计算公式=首重费用+（实际邮寄重量-首重）/续重*续重费用。以江浙沪皖同省跨市件为例，首重1kg，首重费用为10元，在50kg内，每增加1kg，则需要增加2元的运费。那么快递3.5kg的物品的运费=10+（3.5-1）/1*2=16（运费需要向上取整，3.5Kg按4kg计算)

在物流中心里面，需要对运维模板进行管理，在添加商品的时候，对不同的商品要绑定不同的运维模板

2.运费模板列表

菜单：物流中心-运费模板

运费模板包含的数据：

（1）ID

（2）运费模板名称

（3）运费模板类型：固定运费、满X元包邮、自定义规则

（4）运费规则

（5）备注

（6）状态

支持分页查询

支持筛选条件：运费模板名称、运费模板类型（下拉框，默认是全部），状态（下拉框，默认是启用，可选全部/停用）

3.新增运费模板

在列表页的上面，有一个新增按钮，点击之后进入一个界面。这个界面里，可以输入运费模板名称，然后选择运费模板类型，这里会根据选择不同的类型，下面给你显示出来不一样的操作UI组件。

比如说，如果选择了固定运费：让你设置一个固定运费是多少元，固定运费20元。

{“fixed_freigt”: 20}

比如说，选择了满X元包邮：让你设置一个满多少元可以包邮，没达到这么多钱的话，固定运费就是多少钱。

{“threshold”: 100, “less_than_threshold”: 10}

比如说，选择了自定义规则之后：就是下面会出来多个UI组件，你可以加多个规则，每个规则：加一个规则，选择发货到哪些哪些省份，多少重量以内是多少钱；每增加多少g，增加多少钱。

输入一个备注

选择一个状态：启用/停用

4.编辑运费模板

在列表页的右侧操作栏中，有一个编辑按钮，进去编辑页面，回显之前的所有数据，可以重新编辑，然后保存和修改。

5.启用/停用运费模板

在列表页的右侧操作栏中，有一个启用/停用按钮，如果有一些商品已经关联了这个运费模板，不允许直接停用的。

6.删除运费模板

在列表页的右侧操作栏中，有一个删除按钮，如果有一些商品已经关联了这个运费模板，是不允许直接删除的。

2.运费计算

准备提交订单的确认页面上，就会根据每个商品的运费模板，计算出来每个商品对应的一个运费

订单中心会将订单的数据传送过来，然后这里会根据每个商品绑定的运费模板，计算出来每个商品对应的一个运费。包括一个订单的总运费。

如果是自定义规则这种比较复杂的形式，那么在用户选择了商品数量和目的地之后，就可以参照目的地的计算规则，然后算出来重量，根据重量就可以算出来对应的运费

运费的计算公式=首重费用+（实际邮寄重量-首重）/续重*续重费用。以江浙沪皖同省跨市件为例，首重1kg，首重费用为10元，在50kg内，每增加1kg，则需要增加2元的运费。那么快递3.5kg的物品的运费=10+（3.5-1）/1*2=16（运费需要向上取整，3.5Kg按4kg计算)

3.获取物流单

在调度中心调度销售出库的时候，会针对这个订单中的商品，去跟第三方物流厂商的接口进行通信，告诉第三方物流厂商，我们要从哪个仓库里，发送哪些商品，每个商品的重量，长宽高的一些数据，下一个订单，让物流厂商自己去我们的仓库里，取货；或者是，我们是告诉物流厂商，下这么一个物流的订单，然后在仓库里，拣货打包之后，将物流单贴在包裹上，接着将贴了物流单的包裹交给仓库里跟物流厂商的对接人员，物流厂商的人就根据这个物流单号的信息，去进行发货了。

4.物流追踪

在物流发货之后，会自动将订单锁定一个物流单号，然后之后就是查看物流进度的时候，就会调用物流公司的接口，进行物流状态的查询

### 14.评论中心

核心主流程基本都走完了。

（1）采购商品

（2）前台页面

（3）购买商品

（4）商品退货

这块，主要是用户在前台发表评论，然后可以查看每个商品的评论。

后台可以对所有的评论进行人工审核以及查看，可以删除评论。

1.发表评论

1.手动发表评论

在订单列表页，对已经完成的订单，可以点击按钮，发表评论，此时会进入发表评论的这么一个界面中

（1）打分：几颗五角星，一般会对多个维度去打分，商品，客服，物流，我们合并为一个打分

（2）输入评论内容

（3）晒图：支持上传图片

（4）打标签：用已有的评论标签，也可以自己新建一个标签

将商品sku的销售属性同步保存到评论表中

手动发表的评论，状态为：待审核

2.自动发表评论

如果一个订单确认收货后超过30天没有发表评论，则系统自动打一个好评，总评和所有的维度都是5颗星，评论内容就是默认写非常不错的商品，晒图是无，标签是自动打上好评的内置标签

自动发表的评论，状态是：已审核

维护评论汇总数据

自动发表一个评论，会员成长值加5分，积分加5分；如果晒图了，成长值再加5分，积分加5分

2.评论管理

1.评论列表

专门有运营人员，会负责对不断发表的那些新的评论，进行审核，看一下文字、图片有没有违法，有没有涉黄的。

评论列表包含哪些字段：用户名、评论时间、分数、评论内容前多少个文字的截取、打的标签、状态、好评/中评/差评（4星以上是好评，3星是中评，3星以下是差评）、是否晒图、是否追评、是否默认评价。

支持分页查询

支持筛选条件：用户名、评论时间范围去查、分数、状态、评价类型、是否晒图、是否默认评价

2.评论详情

对某一条评论可以点击查看详情，进入一个界面，里面可以看到评论完整的数据

3.审核评论

先校验一下，只有待审核状态的评论，可以执行审核的操作

然后可以对评论进行审核，点击一个审核按钮，可以进入一个审核界面，显示评论所有的数据，点击审核通过/审核不通过

如果审核评论不通过，那么评论对应的成长值和积分会扣减掉

如果审核通过：评论状态变为已审核；会员成长值加5分，积分加5分；如果晒图了，成长值再加5分，积分加5分

如果审核不通过，评论状态变为审核不通过

维护评论汇总数据

4.删除评论

待审核/已审核/审核不通过，三种类型的评论，都可以执行删除评论的操作

如果后续发现有评论不太合理，可以将这个评论删除，点击一个删除按钮之后，将状态变为：已删除就可以了

维护评论汇总数据

3.评论前台列表

审核通过的评论，会在商品详情页的评论列表中显示出来

根据goods_id，将一个spu的所有的评论都查询出来

（1）好评率

（2）热门标签的评价数量s

（3）评论总数、晒图评论数、追评评论数、好评评论数、中评评论数、差评评论数

（4）评论列表：用户名（保留收尾两个字符，中间的是星号），分数，评论内容，晒图，购买的sku的销售属性值，评论时间

（5）评论支持分页，按照标签来筛选，按照晒图/追评/好评/中评/差评来筛选

### 15.会员中心

1.会员个人设置

1、个人信息查询

会员基础信息：注册时间、手机号、性别、生日、邮箱

收货地址（多个，字段：省/市/区、收货人、详细地址、手机号码）

会员等级：会员成长明细，记录会员成长值增减的原因和时间

会员积分：会员积分变动明细，耗积分的来源和消

2.个人信息设置

性别、生日、邮箱、收货地址（多个，字段：省/市/区、收货人、详细地址、手机号码）

2.会员等级管理

1.会员成长模型

（1）RFM模型

客户消费行为特征分析模型

Recency（最近一次消费时间），Frequency（最近一段时间内的消费次数），Monetary（某一个时间范围内的平均客单价或者是累计交易额）

| R（消费间隔） | 对应成长值 | F（消费频次） | 对应成长值 | M（消费金额） | 对应成长值 |
| ------------- | ---------- | ------------- | ---------- | ------------- | ---------- |
| 7天以内       | 50         | 10次以上      | 50         | 1000元以上    | 50         |
| 30天以内      | 30         | 5次以上       | 20         | 500元以上     | 30         |
| 180天以内     | 10         | 2次以上       | 10         | 100元以上     | 20         |
| 360天以内     | -5         | 1次           | 5          | 100元以上     | 10         |
| 360天以上     | -10        | 0次           | -10        | 0             | -20        |

每隔一个固定周期，比如一周吧，每隔一周，对每个用户的RFM都计算一下。

比如一个用户如果最近两次消费间隔在7天以内，成长值就可以累加50，而且7天以内消费了10次以上，成长值再累加50，7天以内的消费金额加起来超过1000元，成长值再次累加50。

如果出现负数，那么就降低会员等级了。

但是这套模型太过于复杂了，一般还是不采取了。

（2）用户行为增长模型

这个模型是比较常见的，比如京东的成长模型：

每天的第一次登录：获得成长值奖励，+5分

购物：订单金额 * 成长系数，算出来一个成长值奖励，10%，100元的商品 * 10% = +10分

评价：对20元以上金额的商品，发表一个评论，可以积累成长值，+10分

晒单：对20元以上金额的商品，进行晒单，可以积累成长值，+10分

退货：扣减成长值，商品金额 * 10%，扣减你的成长值

评论被投诉后删除了：扣减成长值，扣减你的评论的成长值

2.会员等级增长

每天的第一次登录：获得成长值奖励，+5分

购物：订单金额 * 成长系数，算出来一个成长值奖励，10%，100元的商品 * 10% = +10分

评价：对20元以上金额的商品，发表一个评论，可以积累成长值，+10分

晒单：对20元以上金额的商品，进行晒单，可以积累成长值，+10分

退货：扣减成长值，商品金额 * 10%，扣减你的成长值

评论被投诉后删除了：扣减成长值，扣减你的评论的成长值

3.会员等级体系

累加会员的成长值，会员等级体系

100分以下：铜牌会员

100分~500分：银牌会员

500分~1000分：金牌会员

1000分以上：钻石会员

会员一般，在我们这里，主要是跟促销活动相关，创建一个促销活动的时候，有些促销活动，是仅仅针对一些高级别的会员执行的

4.成长值更新

在对应操作发生的时候，会来会员中心更新成长值，同时会根据最新的分数，计算出来这个会员的等级，而且会记录成长值的明细

3.会员积分管理

1.积分策略

跟会员成长模型类似，也是在登录、购物、评价、晒单的时候，可以获得相应积分奖励。

但是积分跟会员成长值是两回事，会员成长值不断增加会增加会员等级，越高的会员等级是有特权的。而积累更多的积分，是用来消费和兑换的。

会员积分，一般是用来兑换礼品的，消耗掉。

都通过同样的成长策略去积累，但是用处不同，会员成长值是不断积累的，不断变多；会员积分是可以消耗掉的，常见的比如说，几百个积分可以兑换一个几十块钱的小东西，充电宝；100积分可以作为1块钱去。

2.积分更新

在做对应操作的时候，会员的积分是会更新的，以后积分是可以用的，会记录积分变更的明细

### 16.促销中心

1、业务知识

促销的类型大致有7种。

满减促销：满100减10、满300减50、满500减80

单品促销：促销期间商品售价直接打折，比如6折

套装促销：A商品50元，B商品80元，一起购买只要120元，便宜10元

赠品促销：购买某个商品可以赠送别的商品

满赠促销：满300元送自拍杆，满500送充电宝，满1000送高端耳机

多买优惠促销：买2件9折，买3件8折，买4件7折

定金促销：双十一常见，付10元定金，可以抵扣30元现金（以后其实我们会讲到电商的双11大促的系统架构，秒杀架构，电商峰值系统架构，电商API网关架构）

2.促销活动

1.促销活动列表

促销活动的数据包含了哪些字段：

（1）ID

（2）促销活动名称

（3）促销开始时间

（4）促销结束时间

（5）针对会员级别

（6）活动备注

（7）创建时间

（8）创建人

（9）状态：待审核、已审核，不是手动控制的，是根据你制定的一个促销开始时间和促销结束时间，自动启用/停用，促销开始时间到了就启用，促销结束时间到了就停用

（10）促销规则

列表显示的字段包含了：ID、促销活动名称、促销开始时间、促销结束时间、针对会员级别、创建时间、创建人、状态

支持分页查询

支持筛选条件：促销活动名称，促销开始时间，促销结束时间，状态（默认是启用，可选全部/停用）

2.新建促销活动

那些促销活动实际上大同小异，主要是分为活动基本信息、促销规则、主商品信息、赠品信息

（1）活动基本信息

促销活动名称、促销开始时间、促销结束时间、会员级别（全员/某等级会员）、活动备注

（2）促销规则

活动规则，选择6种活动里面的某一种，先通过下拉框进行选择，然后根据选择的活动规则，输入具体的活动规则明细

满减促销，那么就要输入一系列的细则，满多少减多少

多买优惠，输入一系列的细则，就是买几件打几折

单品促销，输入一个折扣

套装促销，输入一个折扣

赠品促销

满赠促销，要输入满多少元赠送一些赠品

（2）主商品信息

根据sku编码、商品名称、商品状态、价格范围、商品分类、上架时间，等几个条件，来进行商品的筛选。筛选出来的商品列表的字段包括：SKU编码、商品名称、价格、优惠内容。

满减促销：不要选择商品了，默认就只能范围是全部商品，就是说无论买什么商品，满多少钱就可以立减多少钱，选择一个或者是多个商品，就是代表着针对这些商品有这个优惠；也可以选择全部商品

单品促销：就是要选择一个或者多个商品，也可以选择全部商品，直接会关联上面的那个折扣的

套装促销：要求选择超过1个商品，多个商品，不可以选择全部商品的，最多选择10个以内的商品。如果同时一个订单中出现这多个商品的话，那么就会对这些商品走上面的一个折扣价格

赠品促销：只能选择一个商品或者多个商品，也可以选择全部商品，买这个商品的时候，每个商品都会给一份赠品，赠品在下面设置

满赠促销：默认就是不要选择商品，强制是全部范围的商品，可以选择一个或者多个商品，也可以选择全部商品，就是针对这个商品买满多少钱就赠送一个赠品

多买优惠：可以选择一个或者多个商品，也可以选择全部商品，这个商品买满几件打几折

我说一点，大家看到这里，不知道能不能理解我为什么不愿意去画原型图，原型图太复杂了，不能的情况下，前端界面是各种变化的

刚开始新建完的时候，促销活动的状态根据开始时间来判断一下，如果开始时间是早于当前时间，那么促销活动就直接启用；如果开始时间是晚于当前时间，那么促销活动就处于停用状态

（3）赠品信息

选择赠品其实也是选择商品，跟上面是一样的

赠品促销，可以挂一个或者多个赠品，赠品最多挂10个

满赠促销，也可以挂一个或者多个赠品，赠品最多挂10个

刚新建完一个促销活动，待审核；只有待审核、停用的状态，可以进行编辑，编辑完了以后还是待审核

3.根据ID查询促销活动

根据ID将促销活动的数据查询出来在页面上回显即可

4.编辑促销活动

对促销活动的数据进行编辑即可

5.审核促销活动

对每个促销活动都可以进行审核，在促销活动列表页的右侧操作栏中，有一个审核按钮，如果是待审核状态，可以点击审核按钮。进入一个审核页面，此时会显示促销活动完整的一个信息。然后执行审核，通过/不通过。如果通过审核，就变成已审核。

6.删除促销活动

只有处于停用状态的促销活动可以删除。

7.促销活动的启用/停用

新建一个促销活动之后，到时间就会自动启用这个活动，需要有一个程序在后台去监控每个促销活动的开始和截止的时间，看到到了开始时间，就开始自动将那些促销活动的状态修改为启用即可，监控所有促销活动的截止时间，到时间之后，就自动将促销活动的状态修改为停用。

8.促销活动的前台展示

（1）在商品详情页，需要展示出来促销活动

（2）在购物车页面，也需要同时展示商品的促销活动，要求你手动去选择一个促销活动，每个商品支持可以挂多个促销活动的。此时需要我们手动去下拉列表中选择

一般来说，都是对一个spu去设置这个对应的促销活动的

3.优惠券

很多种优惠券：现金券（无限制直接用）、满减券、折扣券（购买指定商品时打折），实际上是在提交订单的确认页面里，针对整个订单去使用的，不是针对某个商品的

1.优惠券列表

（1）优惠券数据

优惠券信息：优惠券名称、类型（现金券、满减券）、使用条件规则（多少钱的现金券、满减券有一系列细则）、有效时间（范围，开始~结束）、发行量、商品范围

推广信息：发放方式（可发放可领取、仅可发放、仅可领取），推广范围（免费领取、积分兑换），限领数量，会员等级

状态：发放中、发放完、过期

（1）列表页显示的字段

优惠券名称、类型、有效时间、发行量、发放方式、推广范围、限领数量、创建时间、状态

支持分页查询

支持条件筛选：优惠券名称、类型、有效时间、发放方式、状态、推广范围

2.优惠券新建/编辑

新建/编辑，其实就是显示一个表单出来，可以对优惠券所有的数据进行输入和编辑

3.删除优惠券

优惠券的删除，不好随意删除的，你要是删除了以后，就得把发出去的所有的券都给删除了，这个会很麻烦

4.用户领取优惠券

就是在一个领券页面里，可以点击按钮来领取，这里系统需要记录好，当前领了多少张券了，券给了谁。根据发券的数量，维护券的状态。

领取的时候，需要做一些校验：优惠券是否处于有效期内；优惠券的状态：发放中；优惠券的领取方式是否支持用户来领取

领券的逻辑：

（1）插入一条用户领取这个优惠券的记录

（2）对优惠券表中的已经领取的数量，给增加1

（3）维护优惠券的状态，如果券已经领完了，那么就将状态设置成：发放完

5.平台发放优惠券

那就是平台直接发放给所有用户了，在优惠券的列表页的右侧，有一个按钮，就是发放优惠券。随机性发放，根据优惠券有多杀张，随机选择指定的用户来一人一张来发放

这个版本，默认就是给每个用户都发放一张优惠券，这个模式下，不care优惠券的发行数量了，就是给每个用户都强行推送一张优惠券就可以了

发券的逻辑：

（1）给每个用户都插入一个优惠券的领取记录，就很麻烦，而且如果你的用户数量有上百万呢？插入上百万条记录

（2）就是在用户领取券的记录表中插入一条记录，user_account_id设置成-1就可以了，就代表着这个优惠券所有的用户都可以使用

（3）将优惠券表中的领取的数量设置成跟发行量是一样的

（4）优惠券的状态变为：发放完

6.优惠券使用记录

订单号、优惠券、哪个用户、每个优惠券的使用时间

4.拼团

多人拼成一个团，享受一个更低的折扣价格。

在对商品进行支付的时候，会判断这个团是否满团，如果满团，那么就停止支付；否则就支付加入这个团。

接下来在规定时间内，达到指定人数就拼团成功，此时将订单变为待发货，后面走发货流程；否则就拼团失败，则需要取消订单，退换款项。

而且参团的人支付之后，就要立即锁定和扣减库存。

### 17.客服中心

1.退货工单管理

这块主要是在用户进行售后的时候，比如说退货，或者是退款，要走售后工单模块

1.创建退货工单

用户对已经收到货的商品不太满意，申请退货，此时订单中心会通知客服中心，发起一个售后工单。这个售后工单包含了哪些数据呢？

（1）ID

（2）订单编号

（3）创建时间

（4）状态

（5）审核人

（6）审核时间

（7）退货原因

（8）退货备注

（9）退货物流单号

刚开始创建这个售后工单的时候，应该是状态是：待审核

在创建售后工单的时候，不采取随机分配给客服的方式。就是创建出来一个售后工单，要求的是每个售后客服人员，自己关注一下出来的售后工单，如果看到一单，那么就去处理一单。一开始就做的简单一些。内测，跑通流程，还不需要那么复杂的一些东西。

2.退货工单列表

包含的数据有哪些？跟订单的数据是差不多的。具体包含了一个订单中要退货的一些商品的列表。直接就参照订单列表即可：

（1）下单时间、订单编号

（2）订单中的商品列表：缩略图、商品名称、购买数量

（3）收货人、总金额、应付金额、支付方式

（4）订单状态

（5）退货物流单号

（6）退货原因

3.退货工单详情

不是进入订单详情，而是有一个按钮，可以点击后进入退货工单详情页：这个详情页里面，就包含订单所有的详情页数据，同时包含退货工单自己的所有数据，尤其是包括了退货的原因

但是给每个退货工单，加入一些额外的字段：退货工单创建时间、退货工单状态、审核人、审核时间。

4.审核退货工单

在退货工单列表页的右侧操作栏中，有一个审核的按钮，只有退货工单的状态是待审核的时候，才可以点击这个按钮。点击这个按钮之后，也会进入退货工单的详情页面，但是可以进行审核操作，选择通过/不通过。

如果审核不通过，退货工单的状态为：审核不通过；需要通知订单中心，直接将订单的状态设置为交易关闭。

如果审核通过：

（1）此时同样需要将退货工单的状态设置为：待寄送退货商品

5.同步退货物流单号

（1）将退货物流单号保存到退货工单中去

（2）将退货工单的状态设置为：退货商品待收货

6.确认收到退货

（1）收到货之后，根据包裹上的物流单号去查询退货工单，进行一个比对，如果是那个物流单号，那就是收到了退的货品

（2）同时需要拆包，对货品进行一个初步的质量检查、是否足够的数量检查

（3）走线下物流，将商品退还到之前的发货的仓库中去，默认就一个仓库，所以无所谓了，就直接寄回仅有的一个仓库即可

（4）在退货工单列表页的右侧操作栏中，此时如果退货工单的状态是待收货，会显示一个按钮，可以在这里点击确认收货的按钮，此时就会将退货工单的状态修改为：退货待入库

（5）通知订单中心去更新订单的状态为：退货待入库

（5）将售后工单同步到调度中心里面去，由调度中心去执行一个退货入库的调度操作

7.更新退货工单状态

1、退货入库单完成审核

如果退货入库单完成审核之后，就会通知客服中心，将退货工单的状态修改为：退货已入库。同时客服中心需要通知订单中心，将订单的状态也修改为：售后中（退货已入库）。

2、完成退货打款

wms中心会去通知财务中心进行退货打款，完成打款之后，财务中心会通知客服中心已经完成退货打款

（1）将退货工单的状态设置为：完成退款

（2）通知订单中心，将订单的状态设置为：交易关闭（完成退款）

### 18.财务中心

1.采购结算单管理

1.创建采购结算单

接收WMS系统的通知，将采购结算的数据进行保存，此时状态为编辑中

2.购结算单列表

菜单：财务中心-采购结算单管理

显示哪些字段？跟采购入库单列表保持一致就可以了，状态那里，显示采购结算单自己的状态就可以了。采购入库单的3个核心数据，都是需要的，总的交货时间，每个商品的良品率和交货数量。

额外加一个字段，计算出来一个这个采购结算单要支付的总金额（自动根据每个商品的采购价格，以及实际到货的数量，自动推算出来）。

支持分页，支持筛选

创建时间、操作人、最近一次操作时间、审核人、审核时间

3.编辑采购结算单

在列表页的右侧操作栏，有一个编辑按钮，只有对编辑中状态的单子才可以进行编辑。此时可以对采购结算单进行编辑，唯一能编辑的一个字段，就是采购结算单待支付的总金额。

4.提交审核

在列表页的右侧操作栏中，有一个提交审核按钮，只有对编辑中状态的单子才可以进行提交审核。此时点击之后，将单子的状态修改为待审核。

同时，需要通知WMS系统将这个采购入库单的状态修改为待结算

5.审核采购结算单

在列表页的右侧操作栏中，有一个审核按钮，只有带审核状态的采购结算单可以点击这个按钮。点击过后，进入一个审核页面，此时会显示这个采购结算单所有的数据，然后负责审核的人，可以完成审核，执行通过/不通过两个选项即可。

如果说通过了以后

（1）采购结算单的状态变为已完成

（2）通知WMS系统，将采购入库单的状态变为已完成

2.供应商结算管理

1.周期性打款结算

这块的话，主要是对于采购时，与供应商之间的结算提供财务管理功能

根据供应商的结算周期，周期性的统一对所有供应商进行结算和打款，每周/周月/每季度，都要定时触发打款的逻辑，每次触发，要去看看哪些供应商是这个结算周期的，对这个周期内的供应商的财务结算单，去执行打款操作

（1）走银行的接口，去进行财务打款

（2）需要记录下来每次财务结算打款的一个记录和流水，包含：供应商的基本信息，供应商的结算信息，打款具体时间，打款的总金额。还应该将这个流水跟本次打款对应的多个采购结算单关联起来。

2.采购结算流水管理

菜单：财务中心-供应商结算-采购结算流水

这里就可以看到每条流水完整的一个记录，包含了供应商的基本信息，供应商的结算信息，打款时间，打款金额。点击右侧操作栏的一个按钮，查看采购结算单，可以进入一个列表页面，包含了这次打款关联的一些采购结算单（列表如何显示，跟采购结算单列表一样的），可以点击查看每个采购结算单的详细信息。

3.物流公司打款管理

（1）每次审核完一个销售出库单之后，WMS系统就会通知财务中心打款

（2）系统直接基于银行的接口，完成两个账户之间的打款，根据这个订单中的运费来打款即可

（3）每次给物流公司打款，都会记录一条交易流水：订单编号、打款的总金额、哪个物流公司、哪个银行账号、打款的时间。

4.退货打款管理

如果退货入库审核通过之后，就会通知财务中心：

（1）将订单对应的付款退还到用户的账户中

（2）新增一条订单操作日志，类型：完成退款。

（3）新增一条退货打款的流水

### 19.调度中心

1.调度采购入库

接收一个采购单，然后根据这个采购单中的数据，创建一个采购入库单。此时大家可以想象一下，这个采购入库单的数据，首先是需要保留采购单中所有的数据。此时这些数据是不够的。

三个数据：采购入库单里，要保留3个数据，交货时间、良品率、到货比例，比如说iphone8 plus 银灰色 64G，sku，采购的是100件，结果发过来了99件，此时到货比例就是99%。

采购入库单中，需要根据仓库中的每个货位的剩余容量，然后根据商品的采购件数，将每个商品的采购关联分配到对应的货位上去。这个其实是蛮复杂的。每个货位，看一下承载的体积，每个商品长宽高是多少，根据当前每个货位中有多少件商品，来判断说，剩余的货位体积可以放多少件商品。这套其实很复杂的。

在这里不由调度中心代码去做，直接就是将采购入库单，创建好了之后，同步到WMS系统里面去了。

2.调度销售出库

1、业务知识

（1）调度销售出库的基本概念

调度中心负责在订单支付之后，对接WMS系统，让WMS系统创建销售出库单，包括其他的出入库单。

电商后台将一个订单，购买哪些商品，收货地址，告诉调度中心；然后调度中心负责根据仓库的信息，选择那些商品分别在哪个仓库里进行调度，用什么物流发货，多久可以到。

有几个核心的信息：每个商品购买了几件，每个商品自己的毛重是多少，一个商品的总毛重是多少，收货地址是哪里。

（2）管理仓库基础数据

维护仓库信息以及物流公司信息。

仓库信息：仓库名称、地址、联系信息、仓库类型（自营中心仓、自营区域仓）、配送区域。

广州仓库的一级配送区域是广州，二级配送区域是广西、福建、湖南，三级配送区域是其他地方。

每个仓库关联了一些物流公司。

（3）选择发货仓

根据调度规则，按照一定的调度逻辑，来进行商品发货的调度，找到对应的发货仓。

设计一个较为简化的发货调度的方法。

（1）不同的仓库，对不同的区域，是有发货的分级的，越近的地方，分级是越近的。有些太偏远的地方，是不支持发货的。同一个省份，可能多个仓库都可以发货，但是一定是有一个仓库是优先级最高的，比如说湖南发货，杭州仓库对湖南就是二级区域；但是广州仓库，可能对湖南就是一级区域。

（2）根据收货地址所在省份，优先找一下，自己是一级区域的仓库，是否有库存，优先从这个仓库发货；如果一级区域不行，可以找自己是二级区域的仓库，也可以发货；如果二级区域不行，直接不支持对这个地区发货这个商品了。

（3）调度这个仓库中用来发货的货位，首先按照商品上架的时间顺序排序，按照先进先出的原则，有这个商品的货位，按照时间先进先出排序，最早上架的商品排在最前面，先发货。

（4）比如找到一个货位，上面有5件商品，如果你要购买一件这个商品，那么就从这个货位去发货就可以了；如果你要购买10件这个商品，会将你的商品，拆分成两个发货条目，先从一个货位取5个商品，再从下一个货位取5个商品。

（5）最终将订单中的每个商品，都直接绑定到一个仓库的一个货位上去。

2、创建销售出库单

最重要的还是要包含一个订单中的商品如何发货的信息，这里其实就是要将商品关联到对应的货位上去。

这里大家思考，不知道大家还记得不记得，我们之前用户提交订单的时候，实际上调度中心，就已经将订单中的商品跟某个货位中的库存进行了绑定了，甚至都提前锁定了那个货位中这个商品的库存了。商品->货位的调度，已经做好了，而且都已经记录下来了。

此时实际上去创建销售出库单的时候，就是要将之前完成的调度数据，绑定到销售出库单中去，知道从仓库中哪个货位去发哪些商品。

大概的格式：仓库、货位、商品、多少件。

3.创建发货单

发货单，其实放在包裹里面的，告诉用户他买了哪些东西，本次给他发了哪些货。我们可以想象一下，和简化一下。就是平时拿到的这个发货单，基本上可以认为是订单的一个纸质版。

包含的内容如下：

（1）收货人信息（收货人、地址、手机号码）、配送信息（配送方式、运费）、付款信息（支付方式、总金额、促销活动抵扣、优惠券抵扣、应付金额）、发票信息（发票类型、发票抬头、发票内容）

（2）商品列表：缩略图、商品名称、销售属性、商品编号、商品售价、购买数量

（3）订单总金额、运费、促销活动折扣、优惠券折扣、应付总金额

4.创建物流单

跟第三方物流商进行通信，获取一个物流单号。但是这里不是调度中心直接去做这个操作的。调度中心，去跟物流中心进行通信，获取一个物流单。

5.同步到WMS系统

接着将创建好的销售出库单、发货单、物流单，一次性同步到WMS系统去。发货单和物流单，其实是作为销售出库单的一个附属，绑定到销售出库单上的。

3.调度退货入库

（1）调度退货入库

其实调度采购入库，对售后工单中包含的这些退货商品，进行一个调度，将这些商品调度放入一个仓库里，需要根据仓库中的每个货位的剩余容量，然后根据商品的退货件数，将每个商品的退货关联分配到对应的货位上去。

（2）创建退货入库单

创建退货入库单，此时退货入库单基本包含了订单所有的数据，同时有自己独有的一些字段：创建时间、操作人、最近一次操作时间、审核人、审核时间、状态

（3）将退货入库单同步到WMS系统

4.调度中心库存管理

1.采购入库

采购入库之后，WMS系统，会将最新的库存数据发送过来，此时需要更新调度中心本地的仓库中某个商品的可用库存，更新仓库中某个货位某个商品的可用库存。

同时，调度中心更新完自己本地的库存之后，还会继续去调用库存中心，将库存同步过去

2.提交订单

用户提交订单之后，订单中心会通知库存中心更新库存，库存中心会通知调度中心更新库存

调度中心，仓库中商品的可用库存减1，仓库货位中的商品库存减1，还要将仓库中商品的锁定库存加1，仓库货位中的商品锁定库存加1

但是这里有一个问题，就是说，调度中心，需要去做一个将本次订单中的每个商品，都需要去调度和关联到某个或者某些货位上去了。

原则，是先进先出的一个原则，就是说首先来看一下，入库的时候，仓库管理员，一定是尽量将商品放到最近的货位上去的，所以出库的时候，调度中心是可以根据采购入库单中的数据记录，判断出来说，哪些货位有这个商品，然后看一下，这个商品按照上架时间，先进先出的原则，做一个排序。

这个商品最先上到哪个货架上面去，优先从那个货位上去锁定库存。比如假设A-01-1-03货位，有iphone 8 plus 银灰色 64G，100件。而且这个货位是最早上架这个商品的。其实就可以将这个货位的库存进行扣减和锁定。而且这里要记录下来，这个订单每个商品是对应锁定到哪些货位上的库存的。

我们要购买的iphone 8 plus 银灰色 64G，5台。就给关联到了A-01-1-03货位了，此时这个货位的这个商品的可用库存就变成了95件，这个货位的这个商品的锁定库存就变成了5件了。

接着，调度中心，就需要将库存的操作，同步到WMS系统中去，调度这个事情是调度中心去干的，所以直接就通知WMS系统，怎么更新库存即可。

3.支付订单

用户支付之后，订单中心会通知库存中心更新库存，库存中心会通知调度中心，更新库存。此时需要将之前仓库商品的锁定库存减1，仓库商品的已出库库存加1；将仓库货位商品的锁定库存减1，仓库货位商品的已出库库存加1。急着会去通知WMS系统，更新库存。

4.取消订单

将仓库商品的锁定库存减1，仓库商品的可用库存加1；将仓库货位商品的锁定库存减1，仓库货位商品的可用库存加1。接着通知WMS系统，更新库存

5.退货入库

仓库商品的可用库存加1，已出库库存减1；货位商品的可用库存加1，已出库库存减1。继续通知库存中心。

### 20.库存中心

1.库存业务知识

1、库存操作

（1）增加：通过采购入库，相当于是增加库存

（2）锁定：下单之后锁定库存

（3）解锁：订单取消之后释放库存

（4）扣减：订单支付成功之后扣减库存，扣减锁定的库存

（5）返还：退货之后返还库存，就是增加库存

2.库存分层

（1）销售层：销售层的库存，就是在网站上的商品详情页中显示的库存。可销售库存（网站前台显示的库存），锁定库存（下单后锁定库存，支付后扣减库存），已销售库存（支付之后，就是已销售库存），活动库存（做秒杀类促销活动时，预先分配的库存，需要从可销售库存中分配部分给活动库存），预售库存（以后，在促销那块加入拼团，预付参加团购）。

商品的可销售库存

商品的锁定库存

商品的已销售库存

（2）调度层：这块是调度中心负责的，就是对订单调度为发货，与WMS系统对接，按照调度规则，让指定的仓库去发货。分为单仓库存，区域库存（比如华北区域的所有仓库的库存），所有仓库的总库存。调度层是没有所谓的虚拟库存的，都是针对实物库存去调度的。

举个例子，就是比如说有3个仓库，石家庄仓库，杭州仓库，广州仓库。

每个仓库有限定可以发货的区域：石家庄仓库的发货区域，包含了河北省，北京市，东北三省，西北；杭州仓库，支持发货的区域，包括了江浙两省，上海市，湖南，湖北；广州仓库，支持发深圳，广东省，江西省，海南省。

用户在那个网站上面选择自己的区域，一般是支持三级的，到一个区域，省/市/区。我们这里简化，就是可以选择一个省份。

用户选择了一个省份，此时需要ajax发送异步请求，到后台，直接去走调度中心，去查一下支持这个省份的仓库，这个商品，还有没有库存了。

可用库存、锁定库存、已出库库存

仓库中每个商品的可用库存

仓库中每个商品的锁定库存

仓库中每个商品的已出库库存

仓库中每个货位每个商品的可用库存

仓库中每个货位每个商品的锁定库存

仓库中每个货位每个商品的已出库库存

（3）仓库层：这是实物库存，可用库存（可以用于发货的库存），锁定库存（发货单推送到WMS系统之后，会锁定库存），已出库库存。

仓库中每个商品的可用库存

仓库中每个商品的锁定库存

仓库中每个商品的已出库库存

仓库中每个货位每个商品的可用库存

仓库中每个货位每个商品的锁定库存

仓库中每个货位每个商品的已出库库存

3.库存同步

（1）自上而下：下单支付之后，会扣减销售层的库存；流转到调度层，扣减调度层的库存，同时生成发货通知单；最后是发送到指定仓库的WMS，WMS扣减实物库存，然后执行出库。

（2）自下而上：采购入库，退货入库，调拨入库，都会引起库存变动；从仓库层开始，到调度层，再到销售层，都会逐步增加库存。

4.库存操作流程

销售库存一般要和调度层的库存保持一致

（1）提交订单，判断可销售库存是否足够，库存中心 -> 调度中心，再看一下，那个配送区域内的那个仓库，这个商品是否有库存，库存数量是否支持购买

（2）如果可销售库存数量足够

那么库存中心，销售库存减1，锁定库存加1

调度中心，商品总库存减1，通过调度算法选择一个仓库来支持这个商品，找到是哪个仓库会发货，给那个仓库中的商品库存减1，给仓库中调度出来的一个货位的库存减1；对应的商品锁定库存、仓库锁定库存、货位锁定库存，都加1

仓库，仓库总库存减1，货位库存减1；仓库锁定库存加1，仓库货位库存加1

（3）如果用户取消订单

库存中心：销售库存加1，锁定库存减1

调度中心：3个销售库存加1，3个锁定库存减1

仓库：2个销售库存加1，2个锁定库存减1

（3）如果用户确认支付订单

库存中心：锁定库存减1，已销售库存加1

调度中心：3个锁定库存减1，3个已销售库存加1

仓库：2个锁定库存减1，2个已销售库存加1

3、调度库存管理

（1）筛选出有商品库存的仓库

（2）将收获地址与这些仓库的一级配送区域匹配（24小时），不行再去二级（2日），三级（2日以上）

（3）对同一级的仓库按照优先级筛选

4、仓库库存管理 5、库存预警

这个服务要负责定时监控每个商品的库存，如果库存过低的时候，要自动生成采购单及时补货

2.库存管理

1.采购入库

库存中心，是不care仓库和货位层面的东西，一旦有采购入库之后

将某个商品的销售库存累加上对应的值

如果这个商品之前的所属仓库是无，同时销售库存是0，库存状态是无库存，那么此时加入新库存之后，除了更新销售库存，同时会更新一下商品的所属仓库，还会去更新库存状态为有库存

2.提交订单

用户提交订单之后，订单中心会来通知库存中心，将商品的可销售库存扣减1，同时将商品的锁定库存加1。接着库存中心，需要去通知调度中心，去更新这个库存。

3.支付订单

用户支付了订单之后，订单中心会来通知库存中心，将商品的锁定库存减1，将商品的已销售库存加1。接着库存中心需要通知这个调度中心，将调度中心的库存也进行更新操作。

4.取消订单

将商品的锁定库存减1，将商品的可销售库存加1。接着通知调度中心更新库存。

5.退货入库

商品的可销售库存加1，已销售库存减1

### 21.技术挑战

1、高并发 -> 高峰并发量上万，最大的价值和优势在哪里，我们可以基于真实的完整的电商流程和系统架构去做高并发的架构改造，我们是基于各种各样的能支撑高并发的技术在我们真实的大型复杂的架构中，去结合业务，进行架构的改造，有一定业务复杂度的系统，如何去支撑高并发的访问 。

2、海量数据 -> 也是要依靠大量的技术，去支持海量数据的存储和查询，我们到后面是针对这种真实的挑战，去看说各种技术如何结合业务，去改造系统架构，去支撑海量数据的场景 。

3、高可用 -> 各个中心如何保持高可用性，99.99%不能宕机，不能影响购物 。

4、安全性/稳定性/伸缩性/扩展性 。

5、如何快速支撑业务需求的迭代，支撑越来越大的团队快速迭代开发。

业务发展

1、商品中心 -> 大宗商品购买

2、采购中心 -> 支持采购退货

3、WMS -> 库存调拨、库存盘点

4、支付中心 -> 支付网关、资金清算

5、订单中心 -> 订单监控、订单换货

6、物流中心 -> 跟第三方物流公司的对账和结算

7、评论中心 -> 投诉、点赞、回复

8、会员中心 -> 会员充值，礼品卡

9、促销中心 -> 拼团、双11预收、秒杀

10、客服中心 -> 支持售前

11、财务中心 -> 财务进行对账，清算

12、调度中心 -> 盘盈入库、盘亏出库

13、库存中心 -> 库存预警、自动采购补货